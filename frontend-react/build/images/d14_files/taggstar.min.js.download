/*!taggstar-core 3.23.0 | 2025-05-19T12:52:04 | a8d1a4c4eab2d5650655b31961865dae64eeeb0e | Copyright. All rights reserved. 2025. Digital Media Technologies Ltd.

Promise Polyfill | Copyright (c) 2014 Taylor Hakes - Forbes Lindesay | https://github.com/taylorhakes/promise-polyfill/blob/master/LICENSE*/
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(t=>{var e=setTimeout;function s(){}function n(t){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function r(a,s){for(;3===a._state;)a=a._value;0===a._state?a._deferreds.push(s):(a._handled=!0,n._immediateFn(function(){var t,e=1===a._state?s.onFulfilled:s.onRejected;if(null===e)(1===a._state?o:i)(s.promise,a._value);else{try{t=e(a._value)}catch(t){return void i(s.promise,t)}o(s.promise,t)}}))}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===(void 0===t?"undefined":_typeof(t))||"function"==typeof t)){var a=t.then;if(t instanceof n)return e._state=3,e._value=t,void g(e);if("function"==typeof a)return void c((s=a,r=t,function(){s.apply(r,arguments)}),e)}e._state=1,e._value=t,g(e)}catch(t){i(e,t)}var s,r}function i(t,e){t._state=2,t._value=e,g(t)}function g(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,a=t._deferreds.length;e<a;e++)r(t,t._deferreds[e]);t._deferreds=null}function l(t,e,a){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=a}function c(t,e){var a=!1;try{t(function(t){a||(a=!0,o(e,t))},function(t){a||(a=!0,i(e,t))})}catch(t){a||(a=!0,i(e,t))}}n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){var a=new this.constructor(s);return r(this,new l(t,e,a)),a},n.all=function(t){var i=Array.prototype.slice.call(t);return new n(function(r,n){if(0===i.length)return r([]);var o=i.length;for(var t=0;t<i.length;t++)!function e(a,t){try{if(t&&("object"===(void 0===t?"undefined":_typeof(t))||"function"==typeof t)){var s=t.then;if("function"==typeof s)return void s.call(t,function(t){e(a,t)},n)}i[a]=t,0==--o&&r(i)}catch(t){n(t)}}(t,i[t])})},n.resolve=function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(a){return new n(function(t,e){e(a)})},n.race=function(r){return new n(function(t,e){for(var a=0,s=r.length;a<s;a++)r[a].then(t,e)})},n._immediateFn="function"==typeof setImmediate?function(t){setImmediate(t)}:function(t){e(t,0)},n._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},n._setImmediateFn=function(t){n._immediateFn=t},n._setUnhandledRejectionFn=function(t){n._unhandledRejectionFn=t},"undefined"!=typeof module&&module.exports?module.exports=n:t.Promise||(t.Promise=n)})(window),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(t),s=1;s<arguments.length;s++){var r=arguments[s];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(a[n]=r[n])}return a},writable:!0,configurable:!0}),window.taggstar||(window.taggstar={lib:{}}),(o=>{function d(t){var e,a=taggstar.config,s=taggstar.util,r=t.message||"TAGGSTAR: Error!!",n=(()=>{try{var t,e=o.navigator&&o.navigator.userAgent,a=e.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)(\.\d+)+/i)||[];if(/trident/i.test(a[1]))return{name:"IE",version:(t=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""};if("Chrome"===a[1]){if(null!=(t=e.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:t[1]};if(null!=(t=e.match(/\bEdge\/(\d+(.\d+)+)/i)))return{name:"Microsoft Edge",version:t[1]}}return a=a[2]?[a[1],a[0].substring(a[0].indexOf("/")+1)]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&a.splice(1,1,t[1]),{name:a[0],version:a[1]}}catch(t){return{name:"unknown",version:"1"}}})()||{};this.name=t.name||"TaggstarError",this.siteKey=t.siteKey||a&&a.key||taggstar.tm&&taggstar.tm.key,this.code=t.code||"ERR01",this.message=r,this.host=s&&s.getRootDomain()||o.location&&o.location.host,this.href=o.location&&o.location.href,this.timestamp=Date.now(),this.severity=t.severity||50,this.environment=a&&a.environment||taggstar.params&&taggstar.params.taggEnv||"prod",this.browser=n.name,this.browserVersion=n.version,this.locale=o.navigator&&o.navigator.language,this.cookies=(s=["_taggstar_ses","_taggstar_vid","_taggstar_exps"],(e=taggstar.util)&&"function"==typeof e.getCookie?s.map(function(t){return{name:t,value:e.getCookie(t)}}):null),this.module=t.module||(a?a.sp.module:null),this.minSeverity=a?a.errorMinSeverity:0,this.sendingProbability=a?a.errorSendingProbability:1,t.stack?this.stack=t.stack:((n=new Error(r)).name=this.name,this.stack=n.stack||r)}function p(t,e){var a,s,r,n,o,i,g=!1,l=taggstar.util,c=taggstar.log;e=e||0;try{if(!(t instanceof d)&&e<2)throw e+=1,new d({name:t.name,message:t.message,stack:t.stack||t.message});if(l||c){if(taggstar.log(t,"error"),"qa"!==t.environment)try{l.jsonCall&&t instanceof d&&(r=taggstar.config,o=t.sendingProbability,i=t.minSeverity,s=r&&r.api&&r.api.log,t.severity<i||o<=0?g=!0:o<1&&(g=o<(n=Math.random())),taggstar.log(l.renderTemplate("silent mode calculation values are min severity: {errorMinSeverity} - probability: {errorSendingProbability} - random: {random} - silentMode:  {silentMode}}",{errorMinSeverity:i,errorSendingProbability:o,random:n||"NaN",silentMode:g}),"info"),!g)&&s&&(a=r.urls.logRoot+s.endpoint)&&l.jsonCall(s.verb,a,JSON.stringify(t)).then(function(t){taggstar.log("log sent successfully","info")}).catch(function(t){taggstar.log(t,"error")})}catch(t){taggstar.log(t,"error")}}else console.error("TAGGSTAR:",t)}catch(t){p(t,e)}}(d.prototype=Object.create(Error.prototype)).constructor=d,taggstar.exception={Error:d,handle:p}})(window),taggstar.initConfig=function(e,a,t,s){a=a||"prod",s=s&&(s+"").trim().toLowerCase();function r(t,e){return e=c[a][e],l.renderTemplate(t,{alias:e.alias,topLevel:e.topLevel,protocol:e.protocol})}function n(t){return l.renderTemplate(t,{key:e})}var o,i,g=taggstar.exception.Error,l=taggstar.util,c={prod:{api:{topLevel:"com",alias:s?"api."+s:"api",protocol:"https:"},log:{topLevel:"com",alias:s?"log."+s:"log",protocol:"https:"}},qa:{api:{topLevel:"com",alias:"api.qa",protocol:""},log:{topLevel:"com",alias:"log",protocol:""}},dev:{api:{topLevel:"net:8080",alias:"api.dev",protocol:"http:"},log:{topLevel:"net:8080",alias:"log.dev",protocol:"http:"}}};if(!e)throw new g({message:"sitekey should be defined",code:"CONFIG01",severity:99});if(c[a])return o=r("{protocol}//{alias}.taggstar.{topLevel}","api"),i=r("{protocol}//{alias}.taggstar.{topLevel}","log"),{version:"",cookieVersion:"3",idGenerator:taggstar.lib.uuid.generate,key:e,region:s,environment:a,urls:{configRoot:o,apiRoot:o,logRoot:i},currencyCode:"GBP",defaultLocale:"en-GB",locale:"",sitePrefix:"/",deviceType:"",interval:500,tries:50,jquery:"",carouselJS:"",carouselCSS:"",errorMinSeverity:0,errorSendingProbability:1,detail:!1,pageType:"",asst:{experienceRequired:!1,experienceId:"",pageType:""},module:"",experienceRequired:!1,experienceId:"",sp:{experienceRequired:!1,experienceId:"",module:""},api:{category:{endpoint:n("/api/v2/key/{key}/category/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},product:{endpoint:n("/api/v2/key/{key}/product/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},productUpdate:{endpoint:n("/api/v2/key/{key}/product/update"),verb:"POST",mandatoryFields:{},optionalFields:{}},conversion:{endpoint:n("/api/v2/key/{key}/conversion/order"),verb:"POST",mandatoryFields:{},optionalFields:{}},basket:{endpoint:n("/api/v2/key/{key}/basket/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},event:{endpoint:n("/api/v2/key/{key}/event"),verb:"POST"},eventQuery:{endpoint:n("/api/v2/key/{key}/event/query"),verb:"POST"},eventAssistant:{endpoint:n("/api/v2/key/{key}/event/assistant"),verb:"POST"},configuration:{endpoint:n("/api/v2/key/{key}/config{query}"),verb:"GET",mock:t},log:{endpoint:"/api/v1/logs",verb:"POST"},asst:{endpoint:n("/api/v2/key/{key}/recs/assistant"),verb:"POST",mandatoryFields:{},optionalFields:{}},products:{endpoint:n("/api/v2/key/{key}/products"),verb:"GET"}}};throw new g({message:"invalid environment value: "+a,code:"CONFIG02",severity:99,siteKey:e})},(()=>{var p=taggstar.exception.Error;taggstar.util={windowWrapper:{getLocation:function(){return window.location},isCookie:function(){return window.navigator.cookieEnabled},setCookie:function(t){document.cookie=t},getCookie:function(){return document.cookie},createElement:function(t){return document.createElement(t)},appendChild:function(t,e){t.appendChild(e)},getElementsByTagName:function(t){return document.getElementsByTagName(t)},getElementById:function(t){return document.getElementById(t)},getXMLHttpRequest:function(){return new XMLHttpRequest},isLocalStorage:function(){var t="_taggstar_test";try{return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch(t){return!1}},getLocalStorage:function(t){return window.localStorage.getItem(t)},setLocalStorage:function(t,e){window.localStorage.setItem(t,e)},removeLocalStorage:function(t){return window.localStorage.removeItem(t)}},loadTag:function(i,g,l,c,d){return new Promise(function(t,e){g=g||"script",l=l||"head";var a,s,r=taggstar.util,n=r.windowWrapper,o="src";if(i){switch(a=n.createElement(g),g){case"script":a.async=!0;break;case"link":a.type="text/css",a.rel="stylesheet",o="href"}s=n.getElementsByTagName(l),a[o]=i,c&&(a.id=c),d&&(a.integrity=d,a.crossOrigin="anonymous"),a.onload=function(){t({tag:g,url:i,id:c,sri_hash:d})},a.onerror=function(t){t="string"==typeof t?r.renderTemplate("{error} while requesting url: {url}",{error:t,url:i}):t&&t.message?t.message:r.renderTemplate("error while requesting url: {url}",{url:i});e(new p({message:t,code:"UTIL11",severity:99}))},0<s.length?!c||null===n.getElementById(c)?n.appendChild(s[0],a):e(new p({message:r.renderTemplate("trying to add an existing tag: <{url}>",{url:i}),code:"UTIL14",severity:99})):e(new p({message:r.renderTemplate("no <{parent}> tag found to append url: {url}",{parent:l,url:i}),code:"UTIL12",severity:99}))}else e(new p({message:r.renderTemplate("url not provided for <{tag}> tag injection inside <{parent}> element",{tag:g,parent:l}),code:"UTIL01",severity:99}))})},jsonCall:function(t,o,e){return new Promise(function(a,s){var r=taggstar.util,n=r.windowWrapper.getXMLHttpRequest();if(n){e=e||null,n.open(t,o,!0);try{"responseType"in n&&(n.responseType="json")}catch(t){}n.onload=function(){var t=n.status,e="json"===n.responseType?n.response:JSON.parse(n.responseText);200<=t&&t<300?a(e):s(new p({message:r.renderTemplate("{errorDetail} for url: {url}",{status:t,url:o,errorDetail:e&&e.result&&e.result.errorMessage?e.result.errorMessage:"error"}),code:"UTIL09",severity:81}))},n.onerror=function(){s(new p({message:r.renderTemplate("connection failure for url: {url}",{url:o}),code:"UTIL10",severity:81}))},n.send(e)}else s(new p({message:"failed to create XMLHttpRequest object",code:"UTIL13",severity:81}))})},renderTemplate:function(t,e){var a,s;for(a in e)s=e[a],t=t.replace(new RegExp("{"+a+"}","g"),s);return t},isCookie:function(){return taggstar.util.windowWrapper.isCookie()},setCookie:function(t,e,a){var s,r=taggstar&&taggstar.config&&taggstar.config.sitePrefix;if(!t)throw new p({message:"name not defined",code:"UTIL03",severity:81});if(!r)throw new p({message:"sitePrefix not defined",code:"UTIL04",severity:81});a=a?((s=new Date).setTime(s.getTime()+60*a*1e3),"; expires="+s.toUTCString()):"",taggstar.util.windowWrapper.setCookie(t+"="+e+a+"; path="+r+";domain="+taggstar.util.getRootDomain())},getCookie:function(t){for(var e,a=t+"=",s=(taggstar.util.windowWrapper.getCookie()||"").split(";"),r=0;r<s.length;r++){for(e=s[r];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(a))return e.substring(a.length,e.length)}return null},deleteCookie:function(t){taggstar.util.setCookie(t,"",-1)},saveLocalStorage:function(t,e,a){var s;return!!taggstar.util.windowWrapper.isLocalStorage()&&(a=60*(a||30)*1e3,a={value:JSON.stringify(e),timestamp:(new Date).getTime()+a},s="_"+taggstar.config.key,taggstar.util.windowWrapper.setLocalStorage(t+s,JSON.stringify(a)),e)},loadLocalStorage:function(t){var e;return!!taggstar.util.windowWrapper.isLocalStorage()&&(e="_"+taggstar.config.key,!!(t=JSON.parse(taggstar.util.windowWrapper.getLocalStorage(t+e))))&&(new Date).getTime()<t.timestamp&&JSON.parse(t.value)},removeLocalStorage:function(t){var e;return!!taggstar.util.windowWrapper.isLocalStorage()&&(e="_"+taggstar.config.key,taggstar.util.windowWrapper.removeLocalStorage(t+e),!0)},setPageData:function(t,e,a){a=a||taggstar.config.sp.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[a]=taggstar.pageData[a]||{},taggstar.pageData[a][t]=e},getPageData:function(t,e){return e=e||taggstar.config.sp.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[e]=taggstar.pageData[e]||{},taggstar.pageData[e][t]},deletePageData:function(t,e){e=e||taggstar.config.sp.module||"general",taggstar.pageData&&taggstar.pageData[e]&&taggstar.pageData[e][t]&&delete taggstar.pageData[e][t]},decodeCookieString:function(t,e){if(!t)return null;var a,s,r,n,o,i={cookieVersion:t.substring(2,3)},g=parseInt(i.cookieVersion,10);if(isNaN(g)||3<g)return taggstar.util.deleteCookie("_taggstar_exp"),null;try{for(a=t.split("|"),s=1;s<a.length;s++)switch(n=(r=a[s].split(":"))[0],o="null"==r[1]||"undefined"==r[1]?"":r[1],i.cookieVersion){case"1":switch(n){case"visitor":i.id=o;break;case"basket":case"category":case"product":i.experimentGroup=o;break;default:i.experimentId=o}break;case"2":switch(n){case"visitor":i.id=o;break;case"group":i.experimentGroup=o;break;case"id":i.experimentId=o}break;case"3":switch(n){case"group":i.experimentGroup=o;break;case"id":i.experimentId=o}}e||(i.modules={product:i.experimentGroup,category:i.experimentGroup,basket:i.experimentGroup})}catch(t){taggstar.exception.handle(t),taggstar.util.deleteCookie("_taggstar_exp"),i=null}return i},decodeCookieStringV2:function(t){if(!t)return null;var e=null;try{e=JSON.parse(t)}catch(t){taggstar.exception.handle(t),taggstar.util.deleteCookie("_taggstar_exps"),e=null}return e},getRootDomain:function(){var t=taggstar.util.windowWrapper.getLocation().host.toLowerCase(),e=t;return e=null!=t&&1<(t=t.split(".").reverse()).length?2<t.length&&("co"===t[1]||"com"===t[1])?t[2]+"."+t[1]+"."+t[0]:t[1]+"."+t[0]:e},cleanDuplicateProducts:function(t){var e,a,s,r,n,o,i,g,l,c={},d=[];if(!t)return[];for(e=0;e<t.length;e++){if(n=(a=t[e]).id,o=parseFloat(a.unitPrice),i=parseFloat(a.quantity),g=a.category,isNaN(o)||isNaN(i))throw new p({message:"invalid product unit price/quantity value",code:"UTIL07",severity:71});if(!n)throw new p({message:"invalid product id",code:"UTIL08",severity:71});if(a.variant)for(l in a.variant)a.variant.hasOwnProperty(l)&&(n+="_"+a.variant[l]);c[n]?c[n].quantity+=i:(c[n]={quantity:i,unitPrice:o,id:a.id},a.category&&(c[n].category=g),a.variant&&(c[n].variant=a.variant),a.stock&&(c[n].stock=a.stock),a.optionIds&&a.optionIds.length&&(c[n].optionIds=a.optionIds))}for(s in c)c.hasOwnProperty(s)&&(r={id:(a=c[s]).id,quantity:a.quantity,unitPrice:a.unitPrice},a.category&&(r.category=a.category),a.variant&&(r.variant=a.variant),a.stock&&(r.stock=a.stock),a.optionIds&&(r.optionIds=a.optionIds),d.push(r));return d},getBalloonClass:function(t,e,a){var s,r,n="balloon";if(t&&t.code&&t.category)return s="QPH"===t.code,r=!!t.messageTagId,"boolean"==typeof e?s=e:"string"==typeof e&&(n=e),"tagg-reset tagg-"+n+" tagg-"+t.category.toLowerCase()+" tagg-"+t.code+(s?" tagg-hot":"")+(r?" tagg-TAG tagg-"+t.messageTagId.toLowerCase():"")+(a?" "+a:"");throw new p({message:"invalid message parameter",code:"UTIL06",severity:91})},getBalloon:function(t,e,a,s){if(t)return a=taggstar.$.extend({decor:!0,closeButton:!1},a),e='<div class="'+taggstar.util.getBalloonClass(t,e,a.extraBalloonClass)+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+(t.text||t.message)+"</div>",e=(e+=a.decor?'<div class="tagg-reset tagg-decor"></div>':"")+(a.closeButton?'<div class="tagg-reset tagg-x"></div></div>':""),t=taggstar.$(e),a.iconCss&&t.find(".tagg-icon").css(a.iconCss),a.txtCss&&t.find(".tagg-txt").css(a.txtCss),a.closeCss&&t.find(".tagg-x").css(a.closeCss),void 0!==s&&t.data("tagg-index",s),t},getBalloonParams:function(t,e,a){a=a?taggstar._defaultParams.pinnedMessages:taggstar._defaultMessageParams,a=taggstar.$.extend({},a),a=taggstar.$.extend(a,t);return a.wrapperClass+=a.isMobile?"-n":"",a.experienceWrapperClass=taggstar.config.sp.experienceRequired?"tagg-"+taggstar.config.sp.experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",a.callback||"function"!=typeof e||(a.callback=e),a},getParams:function(t,e,a){e=taggstar.$.extend(taggstar._defaultParams[t],e);return e.wrapperClass+=e.isMobile?"-n":"",e.experienceWrapperClass=taggstar.config[t].experienceRequired?"tagg-"+taggstar.config[t].experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",e.callback||"function"!=typeof a||(e.callback=a),e},getBalloonContainer:function(t){var e="tagg-reset "+t.wrapperClass+(t.extraClass?" "+t.extraClass:"")+(t.experienceWrapperClass?" "+t.experienceWrapperClass:"");return t.wrapperStyle?taggstar.$('<div class="'+e+'"></div>').css(t.wrapperStyle):taggstar.$('<div class="'+e+'"></div>')},getQueryParams:function(){var t,e,a,s=taggstar.util.windowWrapper.getLocation().search.substring(1),r={};if(s)for(t=s.split("&"),e=0;e<t.length;e++)0===(a=t[e].split("="))[0].indexOf("tagg")&&(r[a[0]]=!(1<a.length)||a[1]);return r},createTaggstarQueryString:function(){var t,e="?";for(t in taggstar.params)taggstar.params.hasOwnProperty(t)&&(e+=t+"="+taggstar.params[t]+"&");return taggstar.config.detail&&(e+="detail=true&"),e.slice(0,e.length-1)},validateDimensions:function(t){var e,a,s,r={};if(t)for(e=1;e<4;e++)(s=t[a="dim"+e])&&"string"==typeof s&&(r[a]=s.substring(0,32));return r},debugDialog:function(t,e,a){var s;taggstar.debug&&("object"===(void 0===e?"undefined":_typeof(e))&&(e=JSON.stringify(e)),(s=taggstar.$('<div id="dialog"></div>')).append("<h1>"+t+"</h1>"),s.append("<p>"+e+"</p>"),taggstar.$("body").append(s),s.css({position:"fixed",left:"35%",top:"20%",width:"50%",padding:"10px",height:"auto",background:a||"green",color:"white",fontSize:"11px",textAlign:"center",zIndex:1e4}))},getObjectByPath:function(t,e){for(var a=(e=(e=e.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),s=0,r=a.length;s<r;++s){var n=a[s];if(!(n in t))return null;t=t[n]}return t},assistant:{renderAssistantTemplate:function(t,e,a){var s,r,n,o;for(s in e)r=e[s],t=t.replace(new RegExp("{"+s+"}","g"),r);if((n=t.match(/{(\w+)}/g))&&0<n.length&&a)for(var i=0;i<n.length;i++)o=n[i].replace("{","").replace("}",""),t=t.replace(n[i],a[o]);return t},getAssistantCardAttributes:function(t,e,a,s){var r={},n=t;return n&&Object.keys(n).forEach(function(t){if(n.hasOwnProperty(t))switch(t){case"imageUrl":r.imageUrl="function"==typeof e.utils.image?e.utils.image(n.imageUrl):n.imageUrl;break;case"price":r.price="function"==typeof e.utils.price?e.utils.price(n.price,n.salePrice,n.fromPrice):n.price;break;default:r[t]="function"==typeof e.utils[t]?e.utils[t](n[t]):n[t]}}),s&&(r.tagTitle=s.tagTitle,r.tagId=a),r},getAssistantCard:function(t,e,a,s,r){t=taggstar.$('<div class="'+("main"===t?"tagg-asst-main-card":"tagg-asst-card")+'"></div>');return a.cardImageTemplate&&t.append(taggstar.util.assistant.renderAssistantTemplate(a.cardImageTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),a.cardInfoTemplate&&t.append(taggstar.util.assistant.renderAssistantTemplate(a.cardInfoTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),a.cardAdditionalTemplate&&t.append(taggstar.util.assistant.renderAssistantTemplate(a.cardAdditionalTemplate,taggstar.util.assistant.getAssistantCardAttributes(e,a,s,r))),e.socialProofMessages&&0<e.socialProofMessages.length&&(s=taggstar.util.assistant.getAssistantBalloon(e.socialProofMessages,a),(a.balloonAnchor?t.find(a.balloonAnchor):t)[a.balloonAnchorInsertFunction](s)),t},getAssistant:function(e,a,s,t){var r,n;if(a)return t=s.tagClass+" tagg-asst-"+e.toLowerCase()+(t?" "+s.contentSelectedTagSectionClass:""),r=a.sortBy||"popularity",n=taggstar.$('<section data-tag="'+e+'" class="'+t+'"></section>'),a.products.sort(function(t,e){return t[r]-e[r]}).forEach(function(t){n.append(taggstar.util.assistant.getAssistantCard(e,t,s,"list",a))}),n},getAssistantBalloon:function(t,e){var a,s="tagg-reset "+e.balloonWrapperClass+(e.balloonExtraClass?" "+e.balloonExtraClass:""),r=taggstar.$('<div class="'+s+'"></div>');return t.forEach(function(t){a="tagg-reset tagg-asst-balloon tagg-"+t.category.toLowerCase()+" tagg-"+t.code+("QPH"===t.code?" tagg-hot":"")+(e.balloonExtraBalloonClass?" "+e.balloonExtraBalloonClass:""),a=(a='<div class="'+a+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+t.message+"</div>")+(e.balloonDecor?'<div class="tagg-reset tagg-decor"></div>':"")+(e.balloonCloseButton?'<div class="tagg-reset tagg-x"></div></div>':""),a=taggstar.$(a),r.append(a)}),r}},getAlertParams:function(t){var e=taggstar._defaultParams.alert,e=taggstar.$.extend({},e),e=taggstar.$.extend(e,t);return e.experienceClass=taggstar.config.sp.experienceRequired?"tagg-"+taggstar.config.sp.experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",e},getAlert:function(a,s){a=a||{},s=s||{};var t,r=taggstar.$("<div>").addClass("tagg-alert-container"),e=(s.extraClass&&r.addClass(s.extraClass),s.experienceClass&&r.addClass(s.experienceClass),taggstar.$("<button>").addClass("tagg-close-button").html("×").on("click",function(){function t(){"function"==typeof s.onClose&&s.onClose(),r.remove()}var e={category:"alert",name:"close",data:{label:a.id||""}};taggstar.eventRequest(e).then(t).catch(t)})),n=(s.header&&s.header.html&&(t=taggstar.$("<div>").addClass("tagg-alert-header").html(s.header.html),s.header.className)&&t.addClass(s.header.className),taggstar.$("<div>").addClass("tagg-alert-content")),o="",i=(a.imageUrl?o=a.imageUrl:a.images&&Array.isArray(a.images)&&0<a.images.length&&(o=a.images[0].url||""),taggstar.$("<div>").addClass("tagg-alert-img-container")),o=taggstar.$("<img>").addClass("tagg-alert-img").attr("src",o).attr("alt",a.title||"").on("error",function(){i.addClass("tagg-alert-img-error")}),o=(i.append(o),taggstar.$("<div>").addClass("tagg-alert-body-container")),g=taggstar.$("<div>").addClass("tagg-alert-body"),l=(a.messages&&0<a.messages.length&&a.messages[0].message&&(l=a.messages[0].category?a.messages[0].category.toLowerCase():"",c=a.messages[0].code||"",!1===s.splitMessage?(u=taggstar.$("<div>").addClass("tagg-reset tagg-alert-balloon").addClass("tagg-alert-"+l).addClass("tagg-alert-"+c),d=taggstar.$("<div>").addClass("tagg-reset tagg-alert-icon"),u.append(d),d=taggstar.$("<div>").addClass("tagg-reset tagg-alert-txt").html(a.messages[0].message),u.append(d),g.append(u)):(d=a.messages[0].message.match(/<strong>(.*?)<\/strong>/),u=a.messages[0].message.replace(/<strong>.*?<\/strong>/,"").trim(),d&&d[1]&&(d=taggstar.$("<div>").addClass("tagg-alert-power-phrase").addClass("tagg-alert-"+l).addClass("tagg-alert-"+c).html(d[1]),g.append(d)),d=taggstar.$("<div>").addClass("tagg-alert-message").addClass("tagg-alert-"+l).addClass("tagg-alert-"+c).html(u),g.append(d))),taggstar.$("<a>").addClass("tagg-alert-title").attr("href",a.url||"").html(a.title||"")),c=(g.append(l),taggstar.$("<div>").addClass("tagg-alert-price-container")),d=("number"==typeof a.salePrice&&"number"==typeof a.price&&a.salePrice<a.price?(c.append(taggstar.$("<span>").addClass("tagg-alert-original-price").html(taggstar.util.formatAlertPrice(a.price,s.currency||""))),c.append(taggstar.$("<span>").addClass("tagg-alert-sale-price").html(taggstar.util.formatAlertPrice(a.salePrice,s.currency||"")))):"number"==typeof a.price&&c.append(taggstar.$("<span>").addClass("tagg-alert-price").html(taggstar.util.formatAlertPrice(a.price,s.currency||""))),g.append(c),s.additionalContent&&s.additionalContent.html&&(u=taggstar.$("<div>").addClass("tagg-alert-additional").html(s.additionalContent.html),s.additionalContent.className&&u.addClass(s.additionalContent.className),g.append(u)),s.actionButton&&s.actionButton.text||"Continue Checkout"),p=s.actionButton&&s.actionButton.url||a.url||"",l=taggstar.$("<a>").addClass("tagg-alert-action").html(d).attr("href",p).on("click",function(t){t.preventDefault();function e(){"function"==typeof s.onAction&&s.onAction(),p&&(window.location.href=p)}t={category:"alert",name:"checkout",data:{label:a.id||""}};taggstar.eventRequest(t).then(e).catch(e)}),c=taggstar.$("<div>").addClass("tagg-alert-action-container"),u=(c.append(l),s.buttonPlacement||"body");return o.append(g),"body"===u&&o.append(c),n.append(i).append(o),"content"===u&&n.append(c),r.append(e),t&&r.append(t),r.append(n),"container"===u&&r.append(c),r},formatAlertPrice:function(t,e){if("number"!=typeof t||isNaN(t))return t;var e=e||taggstar._defaultParams.alert.currency,a="en";if(e.locale)try{new Intl.NumberFormat(e.locale.replace("_","-")),a=e.locale}catch(t){taggstar.log("Invalid locale: "+e.locale+', falling back to "en"',"warn")}t=t.toLocaleString(a,{minimumFractionDigits:e.decimals||2,maximumFractionDigits:e.decimals||2,useGrouping:!0});return e.separator&&"."!==e.separator&&(t=t.replace(/[.,]/,e.separator)),"post"===e.position?t+e.symbol:e.symbol+t}}})(),(()=>{r||(a=new Array(16),r=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),a[e]=t>>>((3&e)<<3)&255;return a});for(var a,t=Array,s=[],n={},e=0;e<256;e++)s[e]=(e+256).toString(16).substr(1),n[s[e]]=e;function c(t,e){e=e||0;return s[t[e++]]+s[t[e++]]+s[t[e++]]+s[t[e++]]+"-"+s[t[e++]]+s[t[e++]]+"-"+s[t[e++]]+s[t[e++]]+"-"+s[t[e++]]+s[t[e++]]+"-"+s[t[e++]]+s[t[e++]]+s[t[e++]]+s[t[e++]]+s[t[e++]]+s[t[+e]]}var r=r(),d=[1|r[0],r[1],r[2],r[3],r[4],r[5]],p=16383&(r[6]<<8|r[7]),u=0,f=0,o={v1:function(t,e,a){var s=e&&a||0,r=e||[],a=null!=(t=t||{}).clockseq?t.clockseq:p,n=null!=t.msecs?t.msecs:(new Date).getTime(),o=null!=t.nsecs?t.nsecs:f+1;if((i=n-u+(o-f)/1e4)<0&&null==t.clockseq&&(a=a+1&16383),1e4<=(o=(i<0||u<n)&&null==t.nsecs?0:o))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=n,p=a;for(var i=(1e4*(268435455&(n+=122192928e5))+(f=o))%4294967296,o=(r[s++]=i>>>24&255,r[s++]=i>>>16&255,r[s++]=i>>>8&255,r[s++]=255&i,n/4294967296*1e4&268435455),g=(r[s++]=o>>>8&255,r[s++]=255&o,r[s++]=o>>>24&15|16,r[s++]=o>>>16&255,r[s++]=a>>>8|128,r[s++]=255&a,t.node||d),l=0;l<6;l++)r[s+l]=g[l];return e||c(r)},parse:function(t,e,a){var s=e&&a||0,r=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){r<16&&(e[s+r++]=n[t])});r<16;)e[s+r++]=0;return e}};o.unparse=c,o.BufferClass=t,taggstar.lib.uuid={generate:function(){var t=+new Date,e=t-taggstar.initTimestamp;return o.v1({msecs:t,nsecs:e%1e4})}}})(),(()=>{var I=taggstar.exception.Error,h=taggstar.util,e="_taggstar_ses",l="_taggstar_exp",a="_taggstar_exps",s="_taggstar_vid",c="_taggstar_cfg",y="tagg_module",v="tagg_style",b="tagg_jquery",m="|TAGGSTAR|",d=[{id:"sp",value:"socialProof"},{id:"asst",value:"asst"}];taggstar.loaded=!1,taggstar.version="3.23.0",taggstar.constant={null:"_taggstar_null"},taggstar.console=[],taggstar.asst={},taggstar.sp={},taggstar.log=function(t,e){(taggstar.debug||!taggstar.configured&&(taggstar.params&&taggstar.params.taggDebug||h&&h.getQueryParams().taggDebug))&&(e=e||"log",console[e]("TAGGSTAR: ",t),taggstar.console.push({level:e,message:t}))},taggstar.setup=function(){return new Promise(function(d,p){var u,f,m,t,e,a,s;taggstar.configured?p(new I({message:"taggstar already configured",code:"CORE40",severity:99})):(u=taggstar.sri&&taggstar.sri.js,f=taggstar.sri&&taggstar.sri.css,m=taggstar.sri&&taggstar.sri.jquery,t=taggstar.tm&&taggstar.tm.key,a=taggstar.tm&&taggstar.tm.configUrl,s=taggstar.tm&&taggstar.tm.rgn,e=function(t){function e(t){return t=parseInt(t,10),!isNaN(t)&&t}var a,s,r,n,o,i,g=taggstar.config,l=taggstar.tm&&taggstar.tm.style,c=[];t?(r=t.config&&t.config.config,n=t.config&&t.config.libs,o=t.config&&t.config.fileSet,"true"!==t.experienceRequired&&!0!==t.experienceRequired||(g.sp.experienceRequired=!0,g.experienceRequired=!0),!t.recs||"true"!==t.recs.experienceRequired&&!0!==t.recs.experienceRequired||(g.asst.experienceRequired=!0),o&&(a=o.default&&o.default.css,s=o.default&&o.default.js,(i=taggstar.devFileSet)&&(a=o[i]&&o[i].css,s=o[i]&&o[i].js),a)&&s?(g.version=t.version||g.version,r&&(!1!==(o=e(r.maxDataLayerTries))&&-1<o&&(g.tries=o),!1!==(i=e(r.dataLayerRetryIntervalMs))&&-1<i&&(g.interval=i),!1!==(o=e(r.errorMinSeverity))&&(g.errorMinSeverity=o),!1!==(i=(t=>(t=parseFloat(t),!isNaN(t)&&t))(r.errorSendingProbability)))&&0<=i&&(g.errorSendingProbability=i),g.currencyCode=r&&r.defaultCurrencyCode||g.currencyCode,g.defaultLocale=t.defaultLocale||g.defaultLocale,g.jquery=n&&n.jquery||g.jquery,g.sitePrefix=t.config&&t.config.sitePrefix||g.sitePrefix,g.urls.apiRoot=t.apiHostname||g.urls.apiRoot,l&&c.push(h.loadTag(a,"link","head",v,f)),g.jquery&&c.push(h.loadTag(g.jquery,"script","head",b,m)),(c.length?Promise.all(c).then(function(t){t.forEach(function(t){taggstar.log(t.url+" "+t.tag+" tag loaded","info"),"script"===t.tag&&t.id===b&&(taggstar.$=jQuery.noConflict(!0))}),h.loadTag(s,"script","body",y,u).then(function(t){taggstar.log(t.url+" script tag loaded","info"),delete taggstar.tm,d(!0)}).catch(p)}):h.loadTag(s,"script","body",y,u).then(function(t){taggstar.log(t.url+" script tag loaded","info"),delete taggstar.tm,d(!0)})).catch(p)):p(new I({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}))):p(new I({message:"config json data is null/invalid",code:"CORE01",severity:99}))},h.isCookie()?(taggstar.log("setup started","info"),taggstar.initTimestamp=Date.now(),taggstar.params=Object.assign({},taggstar.params,h.getQueryParams()),taggstar.config=taggstar.initConfig(t,taggstar.params.taggEnv,a,s),taggstar.log("config object created with default values","info"),taggstar.configured=!0,taggstar.fakeData=taggstar.params.taggFakeData,taggstar.keepUI=taggstar.params.taggKeepUI,taggstar.devFileSet=taggstar.params.taggDFS,delete taggstar.params.taggKeepUI,delete taggstar.params.taggEnv,delete taggstar.params.taggDFS,taggstar.debug="prod"!==taggstar.config.environment||0<Object.keys(taggstar.params).length,(t=!taggstar.debug&&h.loadLocalStorage(c))?e(t):(a=taggstar.config,s=a.api.configuration,a=a.urls.configRoot+h.renderTemplate(s.endpoint,{query:"?flattened=false"}),s.mock&&(a=s.mock),h.jsonCall(s.verb,a).then(function(t){return taggstar.log("request config from api server","info"),t&&!taggstar.debug&&(taggstar.log("create local storage for config","info"),h.saveLocalStorage(c,t,60)),t}).then(e).catch(p))):(taggstar.log("cookie not supported","info"),d(!1)))})},taggstar.sp.boot=function(c,d){return new Promise(function(t,e){var a,s,r=0,n=!1,o=taggstar.config,i=o.tries,g=o.interval,l=o.jquery;"function"!=typeof c?e(new I({message:"first parameter of taggstar.boot should be type of function",code:"CORE25",severity:99,module:"socialproof"})):(taggstar.booting=!0,taggstar.log("booting..."),s=setInterval(function(){if(taggstar.booting){if(taggstar.$||l||(taggstar.$=window.jQuery),!taggstar.$)return i<=++r?(clearInterval(s),delete taggstar.booting,void e(new I({message:"jQuery couldn't be loaded. jQuery not found",code:"CORE02",severity:99,module:"socialproof"}))):void(r%5==0&&taggstar.log("jQuery not loaded","warn"));if(!a)try{o.sp.module=a=c(),o.module=o.sp.module}catch(t){return i<=++r?(clearInterval(s),delete taggstar.booting,void e(t instanceof I?t:new I({stack:t.stack,name:t.name,message:t.message,code:"CORE03",severity:99,module:"socialproof"}))):void 0}if(a&&a!==taggstar.constant.null)if(d&&d[a]&&"function"==typeof d[a].condition){if(!n)try{n=d[a].condition()}catch(t){return i<=++r?(clearInterval(s),delete taggstar.booting,void e(t instanceof I?t:new I({stack:t.stack,name:t.name,message:t.message,code:"CORE28",severity:99}))):void 0}if(n)if(clearInterval(s),delete taggstar.booting,"function"!=typeof d[a].module)e(new I({message:"settings invalid (module function exists? )",code:"CORE32",severity:99}));else{taggstar.log("successful boot");try{d[a].module(),t(!0)}catch(t){e(t instanceof I?t:new I({stack:t.stack,name:t.name,message:t.message,code:"CORE33",severity:99}))}}else i<=++r?(clearInterval(s),delete taggstar.booting,e(new I({message:"condition failed (data layer missing?)",code:"CORE30",severity:99}))):r%5==0&&taggstar.log("waiting for condition function","warn")}else clearInterval(s),delete taggstar.booting,e(new I({message:"settings invalid (module name or related condition function exists? )",code:"CORE31",severity:99}));else i<=++r?(clearInterval(s),delete taggstar.booting,a===taggstar.constant.null?(taggstar.log("null module detected!","warn"),t(!0)):e(new I({message:"booting failed during module detection (data layer missing?)",code:"CORE29",severity:99,module:"socialproof"}))):(a===taggstar.constant.null&&(a=void 0),r%5==0&&taggstar.log("waiting for module detection function","warn"))}},g))})},taggstar.boot=taggstar.sp.boot,taggstar.init=function(t){if(!taggstar.configured)throw new I({message:"config object not created yet",code:"CORE34",severity:20});if(t.hasOwnProperty("environment")||t.hasOwnProperty("key"))throw new I({message:"key/environment values cannot be set",code:"CORE27",severity:20});if(t.hasOwnProperty("experienceRequired"))throw new I({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(t.hasOwnProperty("experienceId")&&!t.experienceId.trim())throw new I({message:"experienceId value is not valid",code:"CORE36",severity:20});if(t.hasOwnProperty("sp")){if(t.sp.hasOwnProperty("experienceRequired"))throw new I({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(t.sp.hasOwnProperty("experienceId")&&!t.sp.experienceId.trim())throw new I({message:"experienceId value is not valid",code:"CORE36",severity:20})}if(t&&(t.sp=t.sp||{},t.sp.experienceRequired=taggstar.config.experienceRequired,t.sp.experienceId=t.experienceId||"",taggstar.$.extend(taggstar.config.sp,t.sp),delete t.sp),t.hasOwnProperty("asst")){if(t.asst.hasOwnProperty("experienceRequired"))throw new I({message:"experienceRequired value cannot be set",code:"ASST36",severity:20,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)});if(t.asst.hasOwnProperty("experienceId")&&!t.asst.experienceId.trim())throw new I({message:"experienceId value is not valid",code:"ASST35",severity:20,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)});taggstar.$.extend(taggstar.config.asst,t.asst),delete t.asst}taggstar.$.extend(taggstar.config,t)},taggstar.submitData=function(a,r){return new Promise(function(s,i){var g,t,e;taggstar.config?(e=taggstar.config.api[a])?(t=e.verb,g=taggstar.config.urls.apiRoot+e.endpoint,g+=h.createTaggstarQueryString(),taggstar.log("posting data","info"),taggstar.log(r,"info"),e={url:g,data:JSON.stringify(r),dataType:"json",type:t,contentType:!1,success:function(t,e,a){t.result&&t.result.success?s({responseData:t,jqXHR:a}):i(new I({message:t.result.errorMessage,code:"CORE08",severity:51}))},error:function(t,e,a){var s,r,n=t&&t.responseJSON,n=n&&n.result,a=a||"error",o=51;t&&"412"==t.status&&(h.removeLocalStorage(c),taggstar.versionMismatch||(t=taggstar.config.sp.module||taggstar.config.asst.module,s=taggstar.config.key,r=taggstar.config.region,taggstar.versionMismatch=!0,taggstar.tm={key:s,style:"conversion"!==t,region:r},taggstar.$("#"+v).remove(),taggstar.$("#"+y).remove(),taggstar.$("#"+b).remove(),h.setPageData("configured",!1,"asst"),taggstar.configured=!1,taggstar.setup().catch(taggstar.exception.handle)),o=-1),i(new I({message:h.renderTemplate("{errorMessage}: {detailMessage} for url: {url}",{errorMessage:a,url:g,detailMessage:n&&n.errorMessage?n.errorMessage:""}),code:"CORE09",severity:o}))}},taggstar.$.ajax(e)):i(new I({message:"unknown API method: "+a,code:"CORE07",severity:99})):i(new I({message:"config not found",code:"CORE13",severity:99}))})},taggstar.productRequest=function(r,n){return new Promise(function(e,a){var t,s="update"===(n=n||"visit")?"productUpdate":"product";"visit"!==n&&"update"!==n?a(new I({message:"invalid action type: "+n,code:"CORE05",severity:99})):r.id?(r.name=taggstar._sanitizeName(r.name),(t=taggstar._sanitizePrice(r.price)).error?a(new I({message:t.error,code:"CORE06",severity:49})):(r.price=t.price,r.category=taggstar._sanitizeCategory(r.category),t=taggstar._buildRequest({product:r},"sp","product"),taggstar.submitData(s,t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)}))):a(new I({message:"no product id",code:"CORE10",severity:51}))})},taggstar.categoryRequest=function(s){return new Promise(function(e,a){var t;!Array.isArray(s.products)||Array.isArray(s.products)&&0===s.products.length?a(new I({message:"product ids for category cannot be empty",code:"CORE26",severity:51})):(s.category=taggstar._sanitizeCategory(s.category),s.products.some(function(t){return!t})?a(new I({message:"no product id for category: "+s.category,code:"CORE14",severity:51})):(t=taggstar._buildRequest(s,"sp","category"),taggstar.submitData("category",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)})))})},taggstar.basketRequest=function(s){return new Promise(function(e,a){var t;s.lineItems=h.cleanDuplicateProducts(s.lineItems),t=taggstar._buildRequest({basket:s},"sp","basket"),taggstar.submitData("basket",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"sp"),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.conversionRequest=function(s,r){return new Promise(function(e,a){var t;s.id?(t=taggstar._sanitizePrice(s.totalPrice)).error?a(new I({message:t.error,code:"CORE16",severity:49})):(s.orderItems=h.cleanDuplicateProducts(s.orderItems),s.currency=s.currency||taggstar.config.currencyCode,t=taggstar._buildRequest({order:s},null,"conversion",r),taggstar.submitData("conversion",t).then(function(t){h.debugDialog("Conversion successful!",t.responseData,"green"),e(t.responseData)}).catch(function(t){h.debugDialog("Conversion server error!",t,"red"),a(t)})):a(new I({message:"no order id",code:"CORE15",severity:51}))})},taggstar.eventRequest=function(s,r){return new Promise(function(e,a){var t="sp"===(r=r||"sp")?h.getPageData("responseData")&&h.getPageData("responseData").eventGroupId:h.getPageData("responseData",r)&&h.getPageData("responseData",r).eventGroupId;s.eventGroupId||(s.eventGroupId=t),t=taggstar._buildRequest({event:s},r,"event"),taggstar.submitData("asst"==r?"eventAssistant":"event",t).then(function(t){taggstar.log("Following event successfully recorded:\n"+JSON.stringify(s,null,2)),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.eventQueryRequest=function(s,r){return new Promise(function(e,a){var t;r=r||"sp",t=taggstar._buildRequest({query:s},r,"event"),taggstar.submitData("eventQuery",t).then(function(t){taggstar.log("Success"),taggstar.log(t.responseData),e(t.responseData)}).catch(function(t){a(t)})})},taggstar.assistantRequest=function(s){return new Promise(function(e,a){var t;s&&s.productIds&&(!Array.isArray(s.productIds)||Array.isArray(s.productIds)&&0===s.productIds.length)?a(new I({message:"product ids for assistant cannot be empty",code:"ASST26",severity:51,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)})):(t=taggstar._buildRequest(s,"asst"),taggstar.submitData("asst",t).then(function(t){taggstar._addResponseToCookie(t.responseData,t.jqXHR,"asst"),e(t.responseData)}).catch(function(t){a(t)}))})},taggstar.productQueryRequest=function(n){return new Promise(function(e,a){var t,s,r=taggstar.util.createTaggstarQueryString();r?r+="&":r="?",!Array.isArray(n)||Array.isArray(n)&&0===n.length?a(new I({message:"product ids for getProducts cannot be empty",code:"CORE26",severity:51})):n.some(function(t){return!t})?a(new I({message:"missing product id",code:"CORE14",severity:51})):((t=taggstar._getClientObj())&&(t.locale&&(r+="locale="+t.locale+"&"),t.deviceType)&&(r+="deviceType="+t.deviceType+"&"),(t=taggstar._getExperimentObj("sp"))&&0<Object.keys(t).length&&taggstar.params&&!taggstar.params.taggExperienceId&&("experience"===Object.keys(t)[0]?r+="experienceId="+t.experience.id+"&":r+="experimentId="+t.experiment.id+"&experimentGroup="+t.experiment.group+"&"),(t=taggstar.config&&taggstar.config.pageType)&&(r+="pageType="+t+"&"),r+="ids="+n.join(","),taggstar.config?(t=taggstar.config.api.products)?(s=t.verb,taggstar.params&&taggstar.params.taggExperienceId&&(r+="&experienceId="+taggstar.params.taggExperienceId),t=taggstar.config.urls.apiRoot+t.endpoint,t+=r,taggstar.log("getting data","info"),taggstar.util.jsonCall(s,t).then(function(t){taggstar._addResponseToCookie(t,null,"sp"),e(t)}).catch(function(t){a(t)})):a(new I({message:"unknown API method: products",code:"CORE07",severity:99})):a(new I({message:"config not found",code:"CORE13",severity:99})))})},taggstar.getVisitor=function(t){var e=taggstar._updateVisitorSession();return{sessionId:e,id:taggstar._updateVisitorId(t||e)}},taggstar.getExperimentGroup=function(){return taggstar.getExperimentGroupV2("sp")},taggstar.getExperimentGroupV2=function(t){var e=taggstar._getExperimentDataV2();return e&&e[t]&&e[t].group},taggstar.getDetail=function(t){return taggstar.pageData&&taggstar.pageData[t]&&taggstar.pageData[t].responseData&&taggstar.pageData[t].responseData.detail},taggstar.handleProductResponse=function(r){return new Promise(function(t,e){if(r)try{taggstar.log("sp response received","info"),taggstar.log(r,"info");var a=r.socialProof,s=a&&Array.isArray(a)&&a.length?a[0].messages:[];t(taggstar._validateMessages(s||[],!1))}catch(t){e(new I({message:"Failed to process response",code:"CORE22",severity:81,cause:t}))}else e(new I({message:"Invalid response data",code:"CORE21",severity:81}))})},taggstar.handleProductResponseFull=function(c){return new Promise(function(t,e){if(c)try{taggstar.log("sp response received","info"),taggstar.log(c,"info");var a=c.socialProof,s=a&&Array.isArray(a)&&a.length?a[0].messages:[],r=a&&Array.isArray(a)&&a.length&&a[0].pinnedMessages||[],n=taggstar._processAlertWithProduct(c.alerts),o=c.products,i=o&&Array.isArray(o)&&o.length?o[0]:{},g={messages:taggstar._validateMessages(s||[],!1),product:i},l=(null!==n&&(g.alert=n),taggstar._validateMessages(r||[],!0));0<l.length&&(g.pinnedMessages=l),t(g)}catch(t){e(new I({message:"Failed to process response",code:"CORE22",severity:81,cause:t}))}else e(new I({message:"Invalid response data",code:"CORE21",severity:81}))})},taggstar.handleResponseMulti=function(l,c){return new Promise(function(t,e){if(l)try{taggstar.log("sp response received","info"),taggstar.log(l,"info");var a,s,r,n,o,i,g=taggstar._processMultiMessages(l.socialProof);c?(a=taggstar._processAlertWithProduct(l.alerts),s={},r={},n=l.socialProof,o=l.products,i=(n&&Array.isArray(n)&&n.forEach(function(t){var e;t.product&&t.product.id&&t.pinnedMessages&&(e=t.product.variant?t.product.id+m+JSON.stringify(t.product.variant):t.product.id,s[e]=taggstar._validateMessages(t.pinnedMessages.slice(),!0))}),o&&Array.isArray(o)&&o.forEach(function(t){t&&t.id?r[t.id]=t:taggstar.exception.handle(new I({message:"missing product id in products",code:"CORE20",severity:81}))}),{messages:g,products:r}),null!==a&&(i.alert=a),0<Object.keys(s).length&&(i.pinnedMessages=s),t(i)):t(g)}catch(t){e(new I({message:"Failed to process response",code:"CORE22",severity:81,cause:t}))}else e(new I({message:"Invalid response data",code:"CORE21",severity:81}))})},taggstar.handleResponseMultiFull=function(t){return taggstar.handleResponseMulti(t,!0)},taggstar.handleRequest=taggstar.handleProductResponse,taggstar.handleProductResponseWithAttr=taggstar.handleProductResponseFull,taggstar.handleResponseMultiWithAttr=taggstar.handleResponseMultiFull,taggstar.handleAssistantResponse=function(n){return new Promise(function(t,e){taggstar.log("assistant response received","info"),taggstar.log(n,"info");try{var a={shoppingAssistant:n.shoppingAssistant.reduce(function(t,e){var a=e.products.map(function(a){var t=e.socialProof.reduce(function(t,e){return t=e.product.id===a.id?t.concat(e.messages.map(function(t){return{category:t.category,code:t.code,data:t.data,message:t.message,messageTagId:t.messageTagId}})):t},[]);return Object.assign({},a,{socialProofMessages:t})});return t[e.tagId]={tagTitle:e.tagTitle||e.tagId,productCount:e.productCount,products:a},t},{}),templates:n.templates.reduce(function(t,e){return t[e.id]=e.template,t},{}),query:0<n.query.products.length?(s=n.query.products[0],r=(n.query.socialProof.find(function(t){return t.product.id===s.id})||{messages:[]}).messages.map(function(t){return{category:t.category,code:t.code,data:t.data,message:t.message,messageTagId:t.messageTagId}}),Object.assign({},s,{socialProofMessages:r})):{}};taggstar.log(a,"info"),t(a)}catch(t){e(new Error({message:"invalid query result",code:"ASST13",severity:99,module:"asst:"+(taggstar.config.asst&&taggstar.config.asst.pageType)}))}var s,r})},taggstar._defaultMessageParams={firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,iconCss:null,txtCss:null,closeCss:null,wrapperStyle:null,experienceWrapperClass:""},taggstar.displayMessageBalloons=function(f,m,t,y,e,v){return new Promise(function(s,r){var n,o,i,g,l,c;function d(t,e,a){if(a=a||p,t.closeButton&&e.find(".tagg-x").click(function(){taggstar.log("balloon close button clicked");var t=e.data("tagg-index");clearTimeout(o[t]),a(e)}),0===e.data("tagg-index")&&"function"==typeof t.callback)try{t.callback()}catch(t){taggstar.exception.handle(new I({message:"reporting callback failed with error "+t,code:"CORE22",severity:81}))}(v&&!t.keepUI||!v&&!taggstar.keepUI)&&setTimeout(function(){a(e)},t.hold)}function p(t){t.animate(i.animateOut,i.fade,function(){u(t)})}function u(t){t.css({zIndex:"-1",opacity:0,display:"block"}),i.balloonDisplayCount--,0===i.balloonDisplayCount&&(taggstar.log("removing balloon container"),n.remove())}Array.isArray(f)&&f.length?(o=[],i=h.getBalloonParams(t,e,v),g=0,c=v?"searchingPinnedDom":"searchingDom",taggstar[c]=!0,l=setInterval(function(){if(taggstar[c]){var t,e=taggstar.$(m);try{t="function"!=typeof y||y()}catch(t){return++g>i.tries?(clearInterval(l),taggstar[c]=!1,void r(t instanceof I?t:new I({stack:t.stack,name:t.name,message:t.message,code:"CORE04",severity:99}))):void 0}if(!t||0===e.length)return++g>i.tries?(clearInterval(l),taggstar[c]=!1,void r(new I({message:"balloon anchor not present in DOM: "+m+"/condition does not met",code:"CORE11",severity:99}))):void taggstar.log("looking for balloon anchor DOM element/running condition","warn");clearInterval(l),delete taggstar[c],taggstar.log("adding balloons to DOM"),t=h.getBalloonContainer(i);try{e[i.insertFunction](t)}catch(t){return void r(new I({message:"problem applying jQuery method: "+i.insertFunction,code:"CORE12",severity:99}))}n=taggstar.$("."+i.wrapperClass.replace(" ","."));for(var a=0;a<f.length;a++)(t=>{var e=h.getBalloon(f[t],"balloon",i,t);o[t]=setTimeout(function(){i.balloonDisplayCount++,i.customAnimation?i.customAnimation(n,e,i,t,function(t){d(i,e,t)},function(){u(e)}):(e.css(i.animatePre),n.append(e),e.animate(i.animateIn,i.fade,function(){d(i,e)}))},i.firstDelay+t*i.delayBetween)})(a);s(!0)}},i.testInterval)):s(!1)})},taggstar.displayPinnedMessageBalloons=function(t,e,a,s,r){return taggstar.displayMessageBalloons(t,e,a,s,r,!0)},taggstar.displayMessageBalloonsMulti=function(c,d,p,t,u,f){return new Promise(function(t,e){var a,s,r,n,o,i,g,l=h.getBalloonParams(p,u,f);if("function"!=typeof d)e(new I({message:"findAnchor parameter not a function",code:"CORE24",severity:99}));else{for(a in c)for(s=c[a],r=0;r<s.length;r++)if(o=s[r],n=h.getBalloonContainer(l),o=h.getBalloon(o),n.append(o),-1<a.indexOf(m)&&(i=(o=a.split(m))[0],g=o[1]),(o=i?d(i,JSON.parse(g)):d(a))&&o.length){taggstar.log("adding balloons to DOM");try{o[l.insertFunction](n)}catch(t){return void e(new I({message:"problem applying jQuery method: "+l.insertFunction,code:"CORE23",severity:99}))}}else taggstar.log("no anchor returned for product "+(i?i+" and for variant ["+g+"]":a),"warn");t(!0)}})},taggstar.displayPinnedMessageBalloonsMulti=function(t,e,a,s,r){return taggstar.displayMessageBalloonsMulti(t,e,a,s,r,!0)},taggstar.displayAlert=function(g,l,t,c){return taggstar.$(".tagg-alert-container").remove(),new Promise(function(a,s){var r,n,o,i;g&&g.messages&&Array.isArray(g.messages)&&g.messages.length?(r=h.getAlertParams(t),n=0,!1!==r.useDefaultStyles&&taggstar._injectAlertStyles(),r.customStyles&&taggstar._injectCustomAlertStyles(r.customStyles),taggstar.searchingAlertDom=!0,o=setInterval(function(){if(taggstar.searchingAlertDom){var t=taggstar.$(l);try{i="function"!=typeof c||c()}catch(t){return++n>r.tries?(clearInterval(o),taggstar.searchingAlertDom=!1,void s(t instanceof I?t:new I({stack:t.stack,name:t.name,message:t.message,code:"CORE04",severity:99}))):void 0}if(!i||0===t.length)return++n>r.tries?(clearInterval(o),taggstar.searchingAlertDom=!1,void s(new I({message:"alert anchor not present in DOM: "+l+"/condition does not met",code:"CORE11",severity:99}))):void taggstar.log("looking for alert anchor DOM element/running condition","warn");clearInterval(o),delete taggstar.searchingAlertDom,taggstar.log("adding alert popup to DOM");var e=h.getAlert(g,r);t[r.insertFunction](e),setTimeout(function(){e.addClass("tagg-alert-show")},r.firstDelay),a(!0)}},r.testInterval)):a(!1)})},taggstar.displayAssistant=function(R,_,t){return new Promise(function(v,h){var b,x,w,C,k,T,P=JSON.parse(JSON.stringify(R));Object.values(P.shoppingAssistant).some(function(t){return t.products&&0<t.products.length})?(P.selectedTag=(t=>{var e,a=null,s=-1/0;for(e in t)t.hasOwnProperty(e)&&t[e].productCount>s&&(s=t[e].productCount,a=e);return a})(P.shoppingAssistant),b=taggstar.$.extend(taggstar._defaultParams.assistant,t),x=0,C=taggstar.util,k=b.isMobile,T=P.query,C.setPageData("searchingDom",!0,"assistant"),w=setInterval(function(){if(C.getPageData("searchingDom","assistant")){var t=taggstar.$(_);if(0===t.length)return++x>b.tries?(clearInterval(w),C.setPageData("searchingDom",!1,"assistant"),void h(new I({message:"assistant anchor not present in DOM: "+_,code:"CORE11",severity:99}))):void taggstar.log("looking for assistant anchor DOM element","warn");clearInterval(w),C.deletePageData("searchingDom","assistant"),taggstar.log("adding assistant to DOM");0===taggstar.$("style.tagg-asst").length&&taggstar.$("#tagg_style").before(taggstar.$("<style>",{class:"tagg-asst",text:".tagg-asst-body-no-scroll{overflow:hidden}.tagg-asst-modal-background{display:none;position:fixed;z-index:1000000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,0.4)}.tagg-asst-modal{background-color:#fff;margin:auto;padding:1rem;border:1px solid #1e1e1e;border:1px solid rgba(0,0,0,0.45);width:80%;height:80%;max-width:1024px;max-height:768px;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.tagg-asst-modal-background-mobile .tagg-asst-modal{width:100%;height:100%;border:0;top:0;left:0;transform:unset;max-height:100%;overflow-y:scroll}.tagg-asst-content{display:flex;height:100%}.tagg-asst-modal-background-mobile .tagg-asst-content{flex-direction:column}.tagg-asst-filter-close,.tagg-asst-modal-close{color:#333;float:right;font-size:26px;font-weight:bold;position:absolute;right:8px;top:-5px}.tagg-asst-filter-close{color:#999}.tagg-asst-filter-close:hover,.tagg-asst-filter-close:focus,.tagg-asst-modal-close:hover,.tagg-asst-modal-close:focus{text-decoration:none;cursor:pointer}.tagg-asst-content .tagg-asst-left{width:25%;min-width:25%;height:100%}.tagg-asst-content .tagg-asst-right{height:100%;overflow-y:scroll}.tagg-asst-header h1{font-size:2rem}.tagg-asst-tag-list-container{width:100%;padding:1rem;box-sizing:border-box}.tagg-asst-tags-list{list-style:none;padding:0;display:flex;flex-wrap:wrap;gap:.5rem}.tagg-asst-tags-list li{background-color:#fff;border:1px solid #f1f1f1;padding:.2rem .8rem;cursor:pointer;white-space:nowrap}.tagg-asst-tags-list li.tagg-asst-tag-active{background-color:#f1f1f1;border-color:#999}.tagg-asst-tag{display:none;--auto-grid-min-size:10rem;grid-template-columns:repeat(auto-fill,minmax(var(--auto-grid-min-size),1fr));grid-gap:.5rem}.tagg-asst-tag.tagg-asst-selected-tag{display:grid}.tagg-asst-main-card .tagg-asst-image-container img{max-width:100%;height:auto;display:block}.tagg-asst-card img{max-width:100%}.tagg-asst-info-container{margin-top:auto}.tagg-asst-filter-sort-container{display:flex;justify-content:space-between;padding:10px;position:relative}.tagg-asst-filter-container,.tagg-asst-sortby-container{flex:1;margin:.2rem;width:fit-content}.tagg-asst-filter-container button,.tagg-asst-sortby-container button{width:100%;height:50px;background-color:#f1f1f1;border:0;cursor:pointer}.tagg-asst-sortby-menu{display:none;position:absolute;background-color:#fff;box-shadow:0 8px 16px 0 rgba(0,0,0,0.2);width:200px;z-index:1000}.tagg-asst-sortby-menu a{display:block;padding:10px 20px;text-decoration:none;color:black}.tagg-asst-sortby-menu a:hover{background-color:#f1f1f1}.tagg-asst-filter-overlay{height:100%;position:fixed;z-index:2;top:0;width:100%;right:-100%;background-color:#fff;overflow-x:hidden;transition:.5s}"})),t[b.insertFunction](taggstar.$(C.assistant.renderAssistantTemplate(b.buttonTemplate,R.templates)).addClass(b.buttonClass).on("click",function(){taggstar.eventRequest({action:"open"},"asst"),e.show(),taggstar.$("body").addClass("tagg-asst-body-no-scroll")})),e=taggstar.$("<div>",{class:b.modalBackgroundClass+(k?" "+b.modalBackgroundClass+"-mobile":"")}).appendTo("body"),taggstar.$("<div>",{class:b.modalClass}).appendTo("."+b.modalBackgroundClass),taggstar.$(C.assistant.renderAssistantTemplate(b.closeButtonTemplate,R.templates)).addClass(b.closeButtonClass).on("click",function(){taggstar.eventRequest({action:"close"},"asst"),e.hide(),taggstar.$("body").removeClass("tagg-asst-body-no-scroll")}).appendTo("."+b.modalClass),t=taggstar.$("<div>",{class:b.contentClass});var e,a,s,r,n,o,i=function(){taggstar.$("."+b.contentHeaderClass).empty().append(taggstar.$(C.assistant.renderAssistantTemplate(b.headerTemplate,R.templates,P.shoppingAssistant[P.selectedTag])))},g=function(t){var e,a,s;for(s in t?(e=taggstar.$("."+b.contentCardsContainerClass)).empty():e=taggstar.$("<div>",{class:b.contentCardsContainerClass}),P.shoppingAssistant)(a=C.assistant.getAssistant(s,P.shoppingAssistant[s],b,s===P.selectedTag))&&e.append(a);return e},l=function(t){return C.assistant.renderAssistantTemplate(b.sortByText,R.templates)+" "+C.assistant.renderAssistantTemplate("age"===t?b.sortByAgeText:b.sortByPopularityText,R.templates)},c=function(){taggstar.$(".tagg-asst-sortby-button").html(l(P.shoppingAssistant[P.selectedTag].sortBy||"popularity"))},d=(m=taggstar.$("<div>",{class:"tagg-asst-sortby-container"}),u=taggstar.$("<button>",{class:"tagg-asst-sortby-button",html:l("popularity"),click:function(){taggstar.$(".tagg-asst-sortby-menu").show()}}),f=taggstar.$("<div>",{class:"tagg-asst-sortby-menu"}),d=taggstar.$("<a>",{html:C.assistant.renderAssistantTemplate(b.sortByPopularityText,R.templates),click:function(){y("popularity")}}),p=taggstar.$("<a>",{html:C.assistant.renderAssistantTemplate(b.sortByAgeText,R.templates),click:function(){y("age")}}),f.append(d),f.append(p),m.append(u),m.append(f),m),p=(()=>{function t(){var t=taggstar.$(this),t=(taggstar.$("."+b.contentTagsListClass+" li").removeClass("tagg-asst-tag-active"),t.addClass("tagg-asst-tag-active"),P.selectedTag=t.attr("data-tag"),i(),c(),g(!0),{action:"tag",data:{label:P.selectedTag}});taggstar.eventRequest(t,"asst")}var e,a,s=taggstar.$("<div>",{class:b.contentTagsContainerClass}),r=P.shoppingAssistant;for(a in b.tagsLabelTemplate&&s.append(taggstar.$(C.assistant.renderAssistantTemplate(b.tagsLabelTemplate,R.templates))),e=taggstar.$("<ul>",{class:b.contentTagsListClass}),r)e.append(taggstar.$("<li>",{"data-tag":a,html:r[a].tagTitle||a,class:a===P.selectedTag?"tagg-asst-tag-active":"",click:t}));return s.append(e),s})(),u=b.headerTemplate?taggstar.$("<div>",{class:b.contentHeaderClass}).append(taggstar.$(C.assistant.renderAssistantTemplate(b.headerTemplate,R.templates,P.shoppingAssistant[P.selectedTag]))):null,f=C.assistant.getAssistantCard("main",P.query,b,P.selectedTag,P.shoppingAssistant[P.selectedTag]),m=g();k?(u&&t.append(u),f&&t.append(f),a=taggstar.$("<div>",{class:b.contentFilterSortContainerClass}),t.append(a),r=taggstar.$("<button>",{html:C.assistant.renderAssistantTemplate(b.filterButtonText,R.templates)}).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css({right:"0"})}),s=taggstar.$("<div>",{class:"tagg-asst-filter-overlay"}),o=taggstar.$(C.assistant.renderAssistantTemplate(b.filterCloseButtonTemplate,R.templates)).addClass(b.filterCloseButtonClass).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css("right","-100%")}),n=taggstar.$(C.assistant.renderAssistantTemplate(b.filterDoneButtonTemplate,R.templates)).addClass(b.filterDoneButtonClass).on("click",function(){taggstar.$(".tagg-asst-filter-overlay").css("right","-100%")}),s.append(o),s.append(p),s.append(n),(o=taggstar.$("<div>",{class:b.contentFilterContainerClass})).append(s),o.append(r),a.append(o),a.append(d),t.append(m)):T?(t.append(taggstar.$("<div>",{class:b.contentLeftClass}).append(f).append(p)),t.append(taggstar.$("<div>",{class:b.contentRightClass}).append(u).append(d).append(m))):(u&&t.append(u),t.append(taggstar.$("<div>",{class:b.contentFilterSortContainerClass}).append(p).append(d)),t.append(m)),t.appendTo("."+b.modalClass),taggstar.$(window).click(function(t){t=t.target;t==e[0]&&(taggstar.$("body").removeClass("tagg-asst-body-no-scroll"),e.hide()),"tagg-asst-sortby-button"!==(t&&t.className)&&taggstar.$(".tagg-asst-sortby-menu").hide()}),taggstar.$(".tagg-asst-prd-link").on("click",function(t){t.preventDefault();var e=this.href,t=this.getAttribute("data-product");taggstar.eventRequest({action:"product",data:{label:t}},"asst").then(function(){window.location.href=e}).catch(function(){window.location.href=e})}),v(!0)}function y(t){P.shoppingAssistant[P.selectedTag].sortBy=t,g(!0),c(),taggstar.$(".tagg-asst-sortby-menu").hide()}},b.testInterval)):v(!1)})},taggstar._defaultParams={alert:{splitMessage:!0,currency:{symbol:"£",position:"pre",decimals:2,separator:".",locale:"en-GB"},actionButton:{text:"Details",url:null},additionalContent:{html:null,className:null},header:{html:null,className:null},buttonPlacement:"body",experienceClass:"",customStyles:null,useDefaultStyles:!0,firstDelay:500,tries:50,testInterval:500,insertFunction:"append",extraClass:"",onClose:null,onAction:null},pinnedMessages:{firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-pinned-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,experienceWrapperClass:"",keepUI:!1},assistant:{buttonClass:"tagg-asst-button",modalBackgroundClass:"tagg-asst-modal-background",modalClass:"tagg-asst-modal",contentClass:"tagg-asst-content",contentCardsContainerClass:"tagg-asst-cards-container",contentRightClass:"tagg-asst-right",contentLeftClass:"tagg-asst-left",contentHeaderClass:"tagg-asst-header",contentFilterSortContainerClass:"tagg-asst-filter-sort-container",contentFilterContainerClass:"tagg-asst-filter-container",contentTagsContainerClass:"tagg-asst-tag-list-container",contentTagsListClass:"tagg-asst-tags-list",closeButtonClass:"tagg-asst-modal-close",filterCloseButtonClass:"tagg-asst-filter-close",contentSelectedTagSectionClass:"tagg-asst-selected-tag",tagClass:"tagg-asst-tag",isMobile:!1,tries:50,testInterval:500,insertFunction:"append",balloonAnchor:"",balloonAnchorInsertFunction:"append",balloonWrapperClass:"tagg-asst-balloons-wrapper",balloonExtraClass:"",balloonExtraBalloonClass:"",balloonCloseButton:!1,balloonDecor:!1,utils:{},tagsLabelTemplate:"<label>{tags}:</label>",sortByLabelTemplate:"<label>{sortby}:</label>",cardImageTemplate:'<div class="tagg-asst-image-container"><a class="tagg-asst-prd-link" data-event-value="1" data-product="{id}" data-category="{tagId}" href="{url}"><img alt="{title}" title="{title}" src="{imageUrl}" /></a></div>',cardInfoTemplate:'<div class="tagg-asst-info-container"><div class="tagg-asst-info-title"><a class="tagg-asst-prd-link" data-event-value="1" data-product="{id}" data-category="{tag}" href="{url}">{title}</a></div><div class="tagg-asst-info-price">{price}</div></div>',cardAdditionalTemplate:"",headerTemplate:"<h1>{header}</h1>",buttonTemplate:"<button>{button}</button>",closeButtonTemplate:"<span>&times;</span>",filterCloseButtonTemplate:"<span>&times;</span>",filterDoneButtonTemplate:"<button>{done}</button>",filterDoneButtonClass:"tagg-asst-filter-done",filterButtonText:"{filters}",sortByPopularityText:"{popularity}",sortByAgeText:"{age}",sortByText:"{sortby}"}},taggstar._saveExperimentData=function(t){t=JSON.stringify(t);h.setCookie(a,t,129600)},taggstar._updateVisitorSession=function(t){var t=h.getCookie(e)||t;return t?(h.setCookie(e,t,30),t):(t=taggstar.config.idGenerator(),taggstar.log("created new session cookie "+t),h.setCookie(e,t,30),t)},taggstar._updateVisitorId=function(t){var t=h.getCookie(s)||t;return t?(h.setCookie(s,t,129600),t):(t=taggstar.config.idGenerator(),taggstar.log("created new visitor cookie "+t),h.setCookie(s,t,129600),t)},taggstar._getExperimentData=function(t){var e=h.getCookie(l);return e?h.decodeCookieString(e,t):null},taggstar._getExperimentDataV2=function(){var t=h.getCookie(a);return t?h.decodeCookieStringV2(t):null},taggstar._buildRequest=function(t,e,a,s){var r,n,o,i=taggstar.config,g={visitor:taggstar.getVisitor()};for(o in t)t.hasOwnProperty(o)&&(g[o]=t[o]);if((r=taggstar._getClientObj())&&(g.client=r),(n=taggstar._getExperimentObj(e,a))&&0<Object.keys(n).length&&taggstar.params&&!taggstar.params.taggExperienceId)for(var l=0;l<Object.keys(n).length;l++)g[Object.keys(n)[l]]=n[Object.keys(n)[l]];return s&&(g.dimensions=h.validateDimensions(s)),"asst"===e&&"event"!==a&&(g.page={type:i.asst.pageType},i.asst.pageId)&&(g.page.id=i.asst.pageId),g},taggstar._getExperimentObj=function(t,e){if("event"===e)return null;var a,s,r=taggstar.config,n=taggstar._getExperimentData(!0),o=taggstar._getExperimentDataV2()||{},i={};if(n&&(o.sp={id:n.experimentId,group:n.experimentGroup},taggstar._saveExperimentData(o),taggstar.util.deleteCookie(l)),"conversion"===e)for(var g=0;g<d.length;g++)r[s=(a=d[g]).id].experienceRequired?r[s].experienceId&&(i.experiences=i.experiences||{},i.experiences[a.value]={id:r[s].experienceId}):o[s]&&o[s].id&&o[s].group&&(i.experiments=i.experiments||{},i.experiments[a.value]={id:o[s].id,group:o[s].group});else r[t].experienceRequired?r[t].experienceId&&(i={experience:{id:r[t].experienceId}}):(o[t]||(o[t]={id:"",group:""},taggstar._saveExperimentData(o)),o[t]&&o[t].id&&(i={experiment:{id:o[t].id,group:o[t].group}}));return i},taggstar._getClientObj=function(){var t,e=taggstar.config;return(!taggstar.debug&&e.version||e.deviceType||e.locale)&&(t={},!taggstar.debug&&e.version&&(t.expectedSiteConfigVersion=e.version),e.deviceType&&(t.deviceType=e.deviceType),e.locale)&&(t.locale=e.locale),t},taggstar._addResponseToCookie=function(t,e,a){var s;taggstar.config[a].experienceRequired||taggstar._debugParamUsed()?taggstar.config[a].experienceRequired&&taggstar._deleteExperimentCookie(a):(s=taggstar._getExperimentDataV2(),t.experiment&&(s[a].group=t.experiment.group,s[a].id=t.experiment.id),taggstar._saveExperimentData(s)),t.result&&h.setPageData("responseData",{eventGroupId:t.result.eventGroupId,moduleRunId:t.result.moduleRunId,detail:t.detail},"sp"===a?taggstar.config.sp.module:a)},taggstar._deleteExperimentCookie=function(t){var e=taggstar._getExperimentDataV2();e&&(e[t]&&delete e[t],Object.keys(e).length)?taggstar._saveExperimentData(e):h.deleteCookie(a)},taggstar._sanitizeName=function(t){return t&&"string"==typeof t&&(t=(t=t.trim()).replace(/\s+/g," ")).substring(0,64)||"-"},taggstar._sanitizeCategory=function(t){return t=t&&"string"==typeof t&&((t=(t=(t=(t=(t=t.replace(/^\s*/g,"").replace(/\s*$/g,"")).replace(/\s*\/\s*/g,"/")).replace(/\s+/g," ")).replace(/\/$/,"")).substring(0,256))&&"/"!=t[0]&&"-"!==t?"/"+t:t)||"-"},taggstar._sanitizePrice=function(t){var e,a,s={error:"",price:0};if("number"==typeof t)s.price=t;else if(t)try{if(!(0<=(e=t.search(/\d+/))))return s.error="price field contains no digits",s;if(t=t.substring(e),a=parseFloat(t),!isNaN(a))return s.price=a,s;s.error="price field can't be parsed"}catch(t){s.error=t.message}return s},taggstar._debugParamUsed=function(){return taggstar.params.taggExperimentId||taggstar.params.taggExperimentGroup||taggstar.params.taggExperienceId||taggstar.params.taggFakeData||taggstar.params.taggDeviceType||taggstar.params.taggEnv},taggstar._validateMessages=function(t,e){for(var a=e?"pinned message body":"message body",s=t.length-1;0<=s;s--)t[s].message||(t.splice(s,1),taggstar.exception.handle(new I({message:"missing "+a,code:"CORE19",severity:81})));return t},taggstar._processMultiMessages=function(t){var e,a,s,r,n={};if(t&&Array.isArray(t))for(e=0;e<t.length;e++)(a=t[e]).product&&a.product.id?(s=a.product.id,r=a.product.variant&&JSON.stringify(a.product.variant),a.messages&&(n[r?s+m+r:s]=taggstar._validateMessages(a.messages.slice(),!1))):taggstar.exception.handle(new I({message:"missing product id",code:"CORE20",severity:81}));return n},taggstar._processAlertWithProduct=function(t){var e=null;return t&&Array.isArray(t)&&t.length&&(t=t[0]).product&&t.product.id&&t.socialProof&&t.socialProof.messages&&((e=Object.assign({},t.product)).messages=taggstar._validateMessages(t.socialProof.messages.slice(),!1)),e},taggstar._injectAlertStyles=function(){var t=".tagg-alert-container {    position: fixed;    bottom: 20px;    right: 20px;    width: 260px;    background: #fff;    border-radius: 4px;    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);    z-index: 9999;    padding: 8px;    font-family: -apple-system, system-ui, sans-serif;    opacity: 0;    transform: translateX(20px);    transition: all 0.3s ease;    display: flex;    flex-direction: column;    gap: 12px;}.tagg-alert-container.tagg-alert-show {    opacity: 1;    transform: translateX(0);}.tagg-close-button {    position: absolute;    top: 8px;    right: 8px;    width: 20px;    height: 20px;    border: none;    background: none;    color: #666;    font-size: 20px;    cursor: pointer;    padding: 0;    line-height: 1;    z-index: 2;}.tagg-alert-header {    margin: -8px -8px 8px -8px;    padding: 8px;    background: #f5f5f5;    border-radius: 4px 4px 0 0;    font-size: 18px;    font-weight: 500;    color: #333;    border-bottom: 1px solid #eee;    position: relative;    z-index: 1;}.tagg-alert-content {    display: flex;    flex-direction: column;    gap: 12px;}.tagg-alert-img-container {    width: 100%;    height: 160px;}.tagg-alert-img {    width: 100%;    height: 100%;    object-fit: contain;}.tagg-alert-img-error {    background: #f5f5f5;    position: relative;    min-height: 100px;}.tagg-alert-img-error img {    display: none;}.tagg-alert-body-container {    display: flex;    flex-direction: column;    gap: 8px;}.tagg-alert-body {    display: flex;    flex-direction: column;    gap: 8px;}.tagg-alert-power-phrase {    color: #ff0000;    font-weight: 600;    font-size: 18px;    text-transform: uppercase;}.tagg-alert-message {    color: #666;    font-size: 13px;}.tagg-alert-title {    color: #333;    font-size: 13px;    text-decoration: none;}.tagg-alert-price-container {    display: flex;    align-items: center;    gap: 8px;}.tagg-alert-original-price {    color: #999;    text-decoration: line-through;    font-size: 95%;}.tagg-alert-sale-price {    color: #ff0000;    font-weight: 600;}.tagg-alert-price {    font-weight: 600;}.tagg-alert-additional {    color: #666;    font-size: 13px;}.tagg-alert-action-container {    width: 100%;}.tagg-alert-action {    display: block;    width: 100%;    padding: 8px;    background: #333;    color: white;    border: none;    border-radius: 4px;    font-size: 14px;    cursor: pointer;    transition: background 0.2s;    text-align: center;    text-decoration: none;    box-sizing: border-box;}.tagg-alert-action:hover {    background: #444;    text-decoration: none;}.tagg-alert-balloon {    display: flex;    align-items: flex-start;    gap: 8px;    padding: 4px 0;}.tagg-alert-icon {    width: 16px;    height: 16px;    flex-shrink: 0;}.tagg-alert-txt {    flex: 1;    font-size: 13px;    line-height: 1.4;    color: #666;}.tagg-alert-txt strong {    display: inline;    color: #ff0000;    font-weight: 600;    margin: 0;}@media (max-width: 768px) {    .tagg-alert-container {        width: calc(100% - 40px);        margin: 0 10px;        bottom: 10px;        right: 10px;    }}",e=document.createElement("style"),t=(e.type="text/css",e.setAttribute("data-taggstar","alert-styles"),e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t)),document.getElementById("tagg_style")),a=document.querySelector('style[data-taggstar="alert-styles"]');a&&a.parentNode.removeChild(a),t?t.parentNode.insertBefore(e,t):document.head.appendChild(e)},taggstar._injectCustomAlertStyles=function(t){var e=document.createElement("style"),t=(e.type="text/css",e.setAttribute("data-taggstar","custom-alert-styles"),e.appendChild(document.createTextNode(t)),document.querySelector('style[data-taggstar="custom-alert-styles"]'));t&&t.remove(),document.head.appendChild(e)},taggstar.log("methods loaded","info"),taggstar.loaded=!0,taggstar.setup().catch(taggstar.exception.handle)})();