/*!
 * Analytics SDK v1.4.1
 * Environment: production
 * Build: 2025-08-04T07:41:08.818Z
 * Commit: 30499e50bd9f64f7880015673f50b968975aaa99
 */
var AnalyticsSDK=(()=>{var P=Object.defineProperty,Ae=Object.defineProperties,Ee=Object.getOwnPropertyDescriptor,ve=Object.getOwnPropertyDescriptors,_e=Object.getOwnPropertyNames,ae=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var ce=(i,e,t)=>e in i?P(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,p=(i,e)=>{for(var t in e||(e={}))le.call(e,t)&&ce(i,t,e[t]);if(ae)for(var t of ae(e))Ce.call(e,t)&&ce(i,t,e[t]);return i},ge=(i,e)=>Ae(i,ve(e));var De=(i,e)=>{for(var t in e)P(i,t,{get:e[t],enumerable:!0})},Le=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of _e(e))!le.call(i,o)&&o!==t&&P(i,o,{get:()=>e[o],enumerable:!(r=Ee(e,o))||r.enumerable});return i};var Pe=i=>Le(P({},"__esModule",{value:!0}),i);var a=(i,e,t)=>new Promise((r,o)=>{var s=d=>{try{c(t.next(d))}catch(h){o(h)}},n=d=>{try{c(t.throw(d))}catch(h){o(h)}},c=d=>d.done?r(d.value):Promise.resolve(d.value).then(s,n);c((t=t.apply(i,e)).next())});var Oe={};De(Oe,{default:()=>ke});var m=[];for(let i=0;i<256;++i)m.push((i+256).toString(16).slice(1));function de(i,e=0){return(m[i[e+0]]+m[i[e+1]]+m[i[e+2]]+m[i[e+3]]+"-"+m[i[e+4]]+m[i[e+5]]+"-"+m[i[e+6]]+m[i[e+7]]+"-"+m[i[e+8]]+m[i[e+9]]+"-"+m[i[e+10]]+m[i[e+11]]+m[i[e+12]]+m[i[e+13]]+m[i[e+14]]+m[i[e+15]]).toLowerCase()}var Q,Be=new Uint8Array(16);function X(){if(!Q){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Q=crypto.getRandomValues.bind(crypto)}return Q(Be)}var Fe=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Z={randomUUID:Fe};function Ue(i,e,t){if(Z.randomUUID&&!e&&!i)return Z.randomUUID();i=i||{};let r=i.random||(i.rng||X)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let o=0;o<16;++o)e[t+o]=r[o];return e}return de(r)}var ee=Ue;function B(){return ee()}var S=class{constructor(e,t,r,o,s,n,c,d){this.eventName=e;this.timestamp=t;this.clientId=r;this.sessionId=o;this.merchantId=s;this.shopperCountryCode=n;this.category=c;this.cdn=d;this.isSdk=!0}};var F=class extends S{constructor(t,r,o,s,n,c,d,h,T,A,f,y,I,g,u,L,$,z,ne){super("Page View",t,r,o,s,n,c,d);this.timestamp=t;this.clientId=r;this.sessionId=o;this.merchantId=s;this.shopperCountryCode=n;this.category=c;this.cdn=d;this.pageUrl=h;this.pageTitle=T;this.screenResolution=A;this.userAgent=f;this.referrer=y;this.utmSource=I;this.utmMedium=g;this.utmCampaign=u;this.utmTerm=L;this.utmContent=$;this.utmAdSet=z;this.borderfreeProperties=ne}};var U=class extends S{constructor(t,r,o,s,n,c,d,h,T,A,f,y,I,g,u,L,$,z,ne){super("Browsing Start",t,r,o,s,n,c,d);this.timestamp=t;this.clientId=r;this.sessionId=o;this.merchantId=s;this.shopperCountryCode=n;this.category=c;this.cdn=d;this.pageUrl=h;this.pageTitle=T;this.screenResolution=A;this.userAgent=f;this.referrer=y;this.utmSource=I;this.utmMedium=g;this.utmCampaign=u;this.utmTerm=L;this.utmContent=$;this.utmAdSet=z;this.borderfreeProperties=ne}};var w=class extends Error{constructor(e){super(`The "${e}" is not supported.`)}};function l(i){return{toBeDefined(e){if(i==null||typeof i=="string"&&i.trim()==="")throw new Error(e!=null?e:"The value is not defined.");return i},toThrowNotSupported(e){throw new w(e)}}}var ue=new Set(["com","org","net","edu","gov","uk","co.uk","org.uk","gov.uk","ac.uk","au","com.au","net.au","org.au","co.nz","com.sg","com.br","jp","co.jp","ne.jp","or.jp","go.jp","de","fr","us","ca","cn","com.cn","net.cn","org.cn","co.kr","or.kr","go.kr","in","co.in","net.in","org.in","firm.in","gen.in","ind.in"]);function te(i){let e=i.split(".").filter(Boolean);if(e.length<2)return i;let t=e.slice(-2).join("."),r=e.slice(-3).join(".");return ue.has(t)&&e.length>=3?`.${r}`:`.${t}`}var k=class{constructor(e){this.window=l(e).toBeDefined("The window object is required to construct DefaultBrowserAccessor."),this.sessionStorageAsyncWrapper={getItem:t=>Promise.resolve(this.window.sessionStorage.getItem(t)),setItem:(t,r)=>Promise.resolve(this.window.sessionStorage.setItem(t,r)),removeItem:t=>Promise.resolve(this.window.sessionStorage.removeItem(t))},this.localStorageAsyncWrapper={getItem:t=>Promise.resolve(this.window.localStorage.getItem(t)),setItem:(t,r)=>Promise.resolve(this.window.localStorage.setItem(t,r)),removeItem:t=>Promise.resolve(this.window.localStorage.removeItem(t))},this.cookieStorageAsyncWrapper={getItem:t=>{let r=t+"=",s=this.window.document.cookie.split(";").map(n=>n.trim()).find(n=>n.startsWith(r));return Promise.resolve(s?s.substring(r.length):null)},setItem:(t,r)=>{this.window.document.cookie=`${t}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.${this.window.document.domain}`;let o=te(this.window.location.hostname),s=new Date(Date.now()+2*365*24*60*60*1e3).toUTCString();return this.window.document.cookie=`${t}=${encodeURIComponent(r)}; expires=${s}; path=/; domain=${o}`,Promise.resolve()},removeItem:t=>{let r=te(this.window.location.hostname);return this.window.document.cookie=`${t}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;domain=${r}`,Promise.resolve()}}}getPageUrl(){return this.window.location.href}getPageTitle(){return this.window.document.title}getScreenResolution(){return`${this.window.screen.width}x${this.window.screen.height}`}getUserAgent(){return this.window.navigator.userAgent}getReferrer(){return this.window.document.referrer}get sessionStorage(){return this.sessionStorageAsyncWrapper}get localStorage(){return this.localStorageAsyncWrapper}get cookieStorage(){return this.cookieStorageAsyncWrapper}createTrackingPixel(e){let t=this.window.document.createElement("img");t.width=1,t.height=1,t.src=e}createIFrame(e,t,r,o){let s=this.window.document.getElementById(t.attributes.id);s||(s=this.window.document.createElement("iframe"),s.setAttribute("id",t.attributes.id),s.setAttribute("title",t.attributes.title),s.setAttribute("width",t.attributes.width),s.setAttribute("height",t.attributes.height),s.style.display="none",this.window.document.getElementsByTagName("body")[0].appendChild(s)),s.setAttribute("src",e)}},O=class{constructor(e,t,r){this._sessionStorage=l(e).toBeDefined(),this._localStorage=l(t).toBeDefined(),this._cookieStorage=l(r).toBeDefined()}getPageUrl(){}getPageTitle(){}getScreenResolution(){}getUserAgent(){}getReferrer(){}get sessionStorage(){return this._sessionStorage}get localStorage(){return this._localStorage}get cookieStorage(){return this._cookieStorage}createTrackingPixel(e){}createIFrame(e,t,r,o){}};var E=class{constructor(e,t,r,o){this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct DefaultStorageStrategy."),this.FT_3DA_STORAGE_LIFETIME=t,this.STORAGE_KEY=r,this.PREDICATE=o}execute(e){return a(this,null,function*(){let t=Date.now(),r=this.PREDICATE(),o=yield this.browser.localStorage.getItem(this.STORAGE_KEY);if(o)try{let s=JSON.parse(o);if(s.expiry&&t<s.expiry)return r&&(s.expiry=t+this.FT_3DA_STORAGE_LIFETIME*6e4,yield this.browser.localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s))),s;yield this.browser.localStorage.removeItem(this.STORAGE_KEY)}catch(s){yield this.browser.localStorage.removeItem(this.STORAGE_KEY)}if(r){let s=ge(p({},e),{expiry:t+this.FT_3DA_STORAGE_LIFETIME*6e4});return yield this.browser.localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s)),yield this.browser.sessionStorage.removeItem(this.STORAGE_KEY),s}else{let s=yield this.browser.sessionStorage.getItem(this.STORAGE_KEY);if(s===null)return yield this.browser.sessionStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),e;try{return JSON.parse(s)}catch(n){return yield this.browser.sessionStorage.removeItem(this.STORAGE_KEY),null}}})}};var v=class{constructor(e,t){this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct DefaultStorageStrategy."),this.STORAGE_KEY=t}execute(e){return a(this,null,function*(){let t=yield this.browser.sessionStorage.getItem(this.STORAGE_KEY);if(t===null)return yield this.browser.sessionStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)),e;try{return JSON.parse(t)}catch(r){return yield this.browser.sessionStorage.removeItem(this.STORAGE_KEY),null}})}};var me="GlobalE_Analytics_UTMs",he="utm_source",pe="utm_medium",Se="utm_campaign",be="utm_term",fe="utm_content",ye="utm_adset",R=class{constructor(e,t,r){var o,s,n;this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct UtmHandler."),this.logger=l(t).toBeDefined("The ILogger implementation is required to construct UtmHandler."),this.FT_3DA=(o=r==null?void 0:r.FT_3DA)!=null?o:!0,this.FT_3DA_UTM_SOURCE_LIST=(s=r==null?void 0:r.FT_3DA_UTM_SOURCE_LIST)!=null?s:["borderfree"],this.FT_3DA_STORAGE_LIFETIME=(n=r==null?void 0:r.FT_3DA_STORAGE_LIFETIME)!=null?n:4320}handle(e){return a(this,null,function*(){let t=this.getUtmParams(e),o=yield this.selectStorageStrategy(t).execute(t);this.utmSource=o.utmSource,this.utmMedium=o.utmMedium,this.utmCampaign=o.utmCampaign,this.utmTerm=o.utmTerm,this.utmContent=o.utmContent,this.utmAdSet=o.utmAdSet})}getUtmParams(e){var f,y,I;let t="direct",r="(none)",o="(not-set)";try{if(s(e))return c(e);if(n(e))return e;let g=new URL(this.browser.getPageUrl());return{utmSource:(f=g.searchParams.get(he))!=null?f:h(this.browser),utmMedium:(y=g.searchParams.get(pe))!=null?y:T(this.browser),utmCampaign:(I=g.searchParams.get(Se))!=null?I:A(),utmTerm:g.searchParams.get(be),utmContent:g.searchParams.get(fe),utmAdSet:g.searchParams.get(ye)}}catch(g){return this.logger.writeErrorLog({method:"UtmHandler::getUtmParams()",message:g.message,errorMessage:g.message,errorStackTrace:g.stackTrace}),{utmSource:t,utmMedium:r,utmCampaign:o,utmTerm:null,utmContent:null,utmAdSet:null}}function s(g){return typeof g=="string"}function n(g){return typeof g=="object"&&g!==null&&"utmSource"in g&&"utmMedium"in g&&"utmCampaign"in g&&typeof g.utmSource=="string"&&typeof g.utmMedium=="string"&&typeof g.utmCampaign=="string"}function c(g){let u=new URLSearchParams(g);return{utmSource:u.get(he),utmMedium:u.get(pe),utmCampaign:u.get(Se),utmTerm:u.get(be),utmContent:u.get(fe),utmAdSet:u.get(ye)}}function d(g){return g}function h(g){let u=g.getReferrer();return u?u.includes("google")?"google":u.includes("borderfree")?"borderfree":u:t}function T(g){let u=g.getReferrer();return u?u.includes("google")?"organic":"referral":r}function A(){return o}}selectStorageStrategy(e){return this.FT_3DA?new E(this.browser,this.FT_3DA_STORAGE_LIFETIME,me,()=>this.FT_3DA_UTM_SOURCE_LIST.includes(e.utmSource)):new v(this.browser,me)}};var _=class{constructor(){}get(e){return a(this,null,function*(){return yield(yield fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}})).json()})}post(e,t){return a(this,null,function*(){return yield(yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()})}};var G=class{constructor(e,t){this.http=t,this.cdn=e}send(e){return a(this,null,function*(){yield this.http.post(this.cdn,e)})}};var x=class{constructor(e,t){this.cdn=l(e).toBeDefined("The CDN is required to initialize TrackingPixelEventSender."),this.browser=l(t).toBeDefined("The IBrowserAccessor implementation is required to initialize TrackingPixelEventSender.")}send(e){let t=new URL("/client",this.cdn);for(let r in e){let o=e[r];o!=null&&(o&&typeof o=="object"&&(o=JSON.stringify(o)),t.searchParams.append(C.map(r),o))}return this.browser.createTrackingPixel(t.toString()),Promise.resolve()}},C=class{static map(e){switch(e){case"eventName":return"e";case"timestamp":return"t";case"clientId":return"cid";case"sessionId":return"sid";case"merchantId":return"mid";case"shopperCountryCode":return"scc";case"category":return"c";case"cdn":return"cdn";case"pageUrl":return"p";case"pageTitle":return"pt";case"screenResolution":return"sr";case"userAgent":return"ua";case"referrer":return"ref";case"utmSource":return"utm_source";case"utmMedium":return"utm_medium";case"utmCampaign":return"utm_campaign";case"utmTerm":return"utm_term";case"utmContent":return"utm_content";case"utmAdSet":return"utm_adset";default:return e}}};var M=class{constructor(e,t){var r;this.url=l(e).toBeDefined("The URL of the logging server is required to initialize DataTrackingServiceLogger."),this.http=(r=t==null?void 0:t.http)!=null?r:new _}writeLog(r){return a(this,arguments,function*(e,t=3){try{let o={severity:t};typeof e=="string"?o.message=e:o=p(p({},o),e),yield this.http.post(this.url,o)}catch(o){console.error(`DataTrackingServiceLogger::writeLog() - error occured: ${o.message}`,o)}})}writeDebugLog(e){return a(this,null,function*(){return this.writeLog(e,1)})}writeVerboseLog(e){return a(this,null,function*(){return this.writeLog(e,2)})}writeInfoLog(e){return a(this,null,function*(){return this.writeLog(e,3)})}writeWarningLog(e){return a(this,null,function*(){return this.writeLog(e,4)})}writeErrorLog(e){return a(this,null,function*(){return this.writeLog(e,5)})}writeCriticalLog(e){return a(this,null,function*(){return this.writeLog(e,6)})}};var D=class{constructor(){this.logs=[];this.logsLimit=100}writeLog(r){return a(this,arguments,function*(e,t=3){try{let o={timestamp:Date.now(),severity:t};return typeof e=="string"?o.message=e:o=p(p({},o),e),this.logs.push(o),this.logs.length>this.logsLimit&&this.logs.shift(),Promise.resolve()}catch(o){}})}writeDebugLog(e){return a(this,null,function*(){return this.writeLog(e,1)})}writeVerboseLog(e){return a(this,null,function*(){return this.writeLog(e,2)})}writeInfoLog(e){return a(this,null,function*(){return this.writeLog(e,3)})}writeWarningLog(e){return a(this,null,function*(){return this.writeLog(e,4)})}writeErrorLog(e){return a(this,null,function*(){return this.writeLog(e,5)})}writeCriticalLog(e){return a(this,null,function*(){return this.writeLog(e,6)})}},H=class{constructor(e){this.debugOnly=e!=null?e:!1}writeLog(r){return a(this,arguments,function*(e,t=3){try{if(this.debugOnly)console.debug(e);else switch(t){case 1:console.debug(e);break;case 2:console.trace(e);break;case 3:console.info(e);break;case 4:console.warn(e);break;case 5:console.error(e);break;case 6:console.error(e);break;default:break}return Promise.resolve()}catch(o){}})}writeDebugLog(e){return a(this,null,function*(){return this.writeLog(e,1)})}writeVerboseLog(e){return a(this,null,function*(){return this.writeLog(e,2)})}writeInfoLog(e){return a(this,null,function*(){return this.writeLog(e,3)})}writeWarningLog(e){return a(this,null,function*(){return this.writeLog(e,4)})}writeErrorLog(e){return a(this,null,function*(){return this.writeLog(e,5)})}writeCriticalLog(e){return a(this,null,function*(){return this.writeLog(e,6)})}};var j=class extends S{constructor(t,r,o,s,n,c,d,h,T,A,f,y,I,g,u,L){super("Checkout Start",t,r,o,s,n,c,d);this.timestamp=t;this.clientId=r;this.sessionId=o;this.merchantId=s;this.shopperCountryCode=n;this.category=c;this.cdn=d;this.checkoutToken=h;this.userAgent=T;this.utmSource=A;this.utmMedium=f;this.utmCampaign=y;this.utmTerm=I;this.utmContent=g;this.utmAdSet=u;this.borderfreeProperties=L}};var N=class extends S{constructor(t,r,o,s,n,c,d,h,T,A,f,y,I,g,u,L,$,z){super(t,r,o,s,n,c,d,h);this.eventName=t;this.timestamp=r;this.clientId=o;this.sessionId=s;this.merchantId=n;this.shopperCountryCode=c;this.category=d;this.cdn=h;this.checkoutToken=T;this.userAgent=A;this.utmSource=f;this.utmMedium=y;this.utmCampaign=I;this.utmTerm=g;this.utmContent=u;this.utmAdSet=L;this.data=$;this.borderfreeProperties=z}};var K=class extends S{constructor(t,r,o,s,n,c,d,h,T,A,f,y,I,g,u,L,$,z,ne,Re,Ge){super(t,r,o,s,n,c,d,h);this.eventName=t;this.timestamp=r;this.clientId=o;this.sessionId=s;this.merchantId=n;this.shopperCountryCode=c;this.category=d;this.cdn=h;this.pageUrl=T;this.pageTitle=A;this.screenResolution=f;this.userAgent=y;this.referrer=I;this.utmSource=g;this.utmMedium=u;this.utmCampaign=L;this.utmTerm=$;this.utmContent=z;this.utmAdSet=ne;this.data=Re;this.borderfreeProperties=Ge}};var q=class{constructor(e,t){this.cdn=l(e).toBeDefined("The CDN is required to initialize ShopifyFetchEventSender."),this.http=l(t).toBeDefined("The IHttp implementation is required to initialize ShopifyFetchEventSender")}send(e){let t=new URL("/client",this.cdn);for(let r in e){let o=e[r];o!=null&&(o&&typeof o=="object"&&(o=JSON.stringify(o)),t.searchParams.append(C.map(r),o))}return this.http.get(t.toString())}};var V=class{constructor(e,t){this.browser=e,this.logger=t}saveData(e,t){return a(this,null,function*(){var r;try{let o=JSON.stringify(t);yield Promise.all([this.browser.localStorage.setItem(e,o),this.browser.cookieStorage.setItem(e,o)])}catch(o){throw(r=this.logger)==null||r.writeErrorLog({method:"DataStorageManager::saveData()",message:o.message,errorMessage:o.stack||o.message}),new Error(`Failed to save data: ${o.message}`)}})}loadData(e){return a(this,null,function*(){var o,s;let t=null,r=null;try{let n=yield this.browser.cookieStorage.getItem(e);if(n){let c=decodeURIComponent(n);t=JSON.parse(c)}}catch(n){(o=this.logger)==null||o.writeWarningLog({method:"DataStorageManager::loadData()",message:"Failed to parse cookie data.",errorMessage:n.message})}try{let n=yield this.browser.localStorage.getItem(e);n&&(r=JSON.parse(n))}catch(n){(s=this.logger)==null||s.writeWarningLog({method:"DataStorageManager::loadData()",message:"Failed to parse localStorage data.",errorMessage:n.message})}return this.getFreshestValidSnapshot(t,r)})}clearData(e){return a(this,null,function*(){var t;try{yield Promise.all([this.browser.localStorage.removeItem(e),this.browser.cookieStorage.removeItem(e)])}catch(r){throw(t=this.logger)==null||t.writeErrorLog({method:"DataStorageManager::clearData()",message:"Failed to clear data.",errorMessage:r.message}),new Error(`Failed to clear data: ${r.message}`)}})}getFreshestValidSnapshot(e,t){if(e&&t){let r=e==null?void 0:e.dataUpdatedAt,o=t==null?void 0:t.dataUpdatedAt;if(r&&o)return r>o?e:t}return e!=null?e:t}};var b="GlobalE_Analytics_GoogleAds",re="gclid",oe="bfgclid";var W=class{get googleClickId(){return this.isBorderfreeGoogleClickId?this.bfgclid:this.gclid}get isBorderfreeGoogleClickId(){return this.bfIsEnabled&&this.bfgclid}constructor(e,t,r){var o,s;this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct GoogleAdsHandler."),this.logger=l(t).toBeDefined("The ILogger implementation is required to construct GoogleAdsHandler."),this.bfIsEnabled=(o=r==null?void 0:r.bfGoogleAdsEnabled)!=null?o:!0,this.bfLifetimeInDays=(s=r==null?void 0:r.bfGoogleAdsLifetimeInDays)!=null?s:30}handle(e){return a(this,null,function*(){if(!this.bfIsEnabled)return;let t=this.parseUrl(e),o=yield this.selectStorageStrategy().execute(t);this.gclid=o.gclid,this.bfgclid=o.bfgclid})}parseUrl(e){let t={gclid:null,bfgclid:null};try{if(r(e))return o(e);if(s(e))return e;let c=new URL(this.browser.getPageUrl());t.gclid=c.searchParams.get(re),t.bfgclid=c.searchParams.get(oe)}catch(c){this.logger.writeErrorLog({method:"GoogleAdsHandler::parseUrl()",message:c.message,errorMessage:c.message,errorStackTrace:c.stackTrace})}return t;function r(c){return typeof c=="string"}function o(c){let d=new URLSearchParams(c);return{gclid:d.get(re),bfgclid:d.get(oe)}}function s(c){return typeof c=="object"&&c!==null&&"gclid"in c&&"bfgclid"in c&&typeof c.gclid=="string"&&typeof c.bfgclid=="string"}function n(c){return c}}selectStorageStrategy(){return this.bfIsEnabled?new se(this.browser,this.bfLifetimeInDays):new ie(this.browser)}},ie=class{constructor(e){this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct DefaultStorageStrategy.")}execute(e){return a(this,null,function*(){try{if(e.gclid){let t={gclid:e.gclid,expiry:Date.now()+2592e6},r=JSON.stringify(t);return yield this.browser.localStorage.setItem(b,r),{gclid:t.gclid,bfgclid:null}}else{let t=yield this.browser.localStorage.getItem(b),r=JSON.parse(t);return r!=null&&r.expiry&&r.expiry<Date.now()?(yield this.browser.localStorage.removeItem(b),{gclid:null,bfgclid:null}):{gclid:r==null?void 0:r.gclid,bfgclid:null}}}catch(t){return{gclid:null,bfgclid:null}}})}},se=class{constructor(e,t){this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct BorderfreeStorageStrategy."),this.bfLifetimeInDays=t}execute(e){return a(this,null,function*(){try{if(e.bfgclid){let t={bfgclid:e.bfgclid,expiry:Date.now()+this.bfLifetimeInDays*24*60*60*1e3},r=JSON.stringify(t);return yield this.browser.localStorage.setItem(b,r),{gclid:null,bfgclid:e.bfgclid}}else{let t=yield this.browser.localStorage.getItem(b),r=JSON.parse(t);if(r!=null&&r.expiry&&r.expiry<Date.now())yield this.browser.localStorage.removeItem(b);else{if(r!=null&&r.bfgclid)return{gclid:null,bfgclid:r.bfgclid};if(r!=null&&r.gclid)return{gclid:r.gclid,bfgclid:null}}if(e.gclid){let o={gclid:e.gclid,expiry:Date.now()+2592e6},s=JSON.stringify(o);return yield this.browser.localStorage.setItem(b,s),{gclid:o.gclid,bfgclid:null}}else return{gclid:null,bfgclid:null}}}catch(t){return{gclid:null,bfgclid:null}}})}};var Ie="GlobalE_Analytics_Borderfree",we="bf_direct_to_checkout",Te="bf_direct_to_checkout_enabled",Y=class{constructor(e,t,r){var o,s,n;this.browser=l(e).toBeDefined("The IBrowserAccessor implementation is required to construct BorderfreeHandler."),this.logger=l(t).toBeDefined("The ILogger implementation is required to construct BorderfreeHandler."),this.FT_3DA=(o=r==null?void 0:r.FT_3DA)!=null?o:!0,this.FT_3DA_UTM_SOURCE_LIST=(s=r==null?void 0:r.FT_3DA_UTM_SOURCE_LIST)!=null?s:["borderfree"],this.FT_3DA_STORAGE_LIFETIME=(n=r==null?void 0:r.FT_3DA_STORAGE_LIFETIME)!=null?n:4320}handle(e,t){return a(this,null,function*(){let r=this.getBorderfreeParams(e),s=yield this.selectStorageStrategy(t).execute(r);this.directToCheckout=s.directToCheckout,this.directToCheckoutEnabled=s.directToCheckoutEnabled})}getBorderfreeParams(e){try{if(t(e))return o(e);if(r(e))return e;let n=new URL(this.browser.getPageUrl()),c=n.searchParams.get(we),d=n.searchParams.get(Te);return p(p({},c&&{directToCheckout:c}),d&&{directToCheckoutEnabled:d})}catch(n){return this.logger.writeErrorLog({method:"BorderfreeHandler::getBorderfreeParams()",message:n.message,errorMessage:n.message,errorStackTrace:n.stackTrace}),{}}function t(n){return typeof n=="string"}function r(n){return typeof n=="object"&&n!==null&&("directToCheckout"in n||"directToCheckoutEnabled"in n)&&(!("directToCheckout"in n)||typeof n.directToCheckout=="string")&&(!("directToCheckoutEnabled"in n)||typeof n.directToCheckoutEnabled=="string")}function o(n){let c=new URLSearchParams(n),d=c.get(we),h=c.get(Te);return p(p({},d&&{directToCheckout:d}),h&&{directToCheckoutEnabled:h})}function s(n){return n}}selectStorageStrategy(e){return this.FT_3DA?new E(this.browser,this.FT_3DA_STORAGE_LIFETIME,Ie,()=>this.FT_3DA_UTM_SOURCE_LIST.includes(e)):new v(this.browser,Ie)}};var J=class{constructor(e,t){this.ANALYTICS_STORAGE_KEY="GlobalE_Analytics";this.eventQueue=[];this.isConfigurationLoaded=!1;this.isInitialized=!1;this.FT_3DA=!0;this.FT_3DA_UTM_SOURCE_LIST=["borderfree"];this.FT_3DA_STORAGE_LIFETIME=4320;this.FT_BF_GOOGLE_ADS=!1;this.FT_BF_GOOGLE_ADS_LIFETIME=30;this.ExpirationTime=30;this.DATA_TRACKING_SERVICE_API_URL="https://utils.global-e.com",this.MONOLITH_API_URL="",this.http=e!=null?e:new _,this.logger=t!=null?t:new D}get ClientId(){return this.clientId}get SessionId(){return this.sessionId}get UtmSource(){return this.utms.utmSource}get UtmMedium(){return this.utms.utmMedium}get UtmCampaign(){return this.utms.utmCampaign}get googleClickId(){var e;return(e=this.googleAds)==null?void 0:e.googleClickId}get isBorderfreeGoogleClickId(){var e;return(e=this.googleAds)==null?void 0:e.isBorderfreeGoogleClickId}loadConfigurationSnapshot(){return a(this,null,function*(){try{let e=yield this.dataStorageManager.loadData(this.ANALYTICS_STORAGE_KEY);if(e===null){this.logger.writeInfoLog({method:"AnalyticsSDK::loadConfigurationSnapshot()",message:"Snapshot is not found in Local Storage"});return}this.merchantId=l(e.merchantId).toBeDefined("Snapshot integrity violated. The `merchantId` is missing."),this.shopperCountryCode=e.shopperCountryCode,this.cdn=l(e.cdn).toBeDefined("Snapshot integrity violated. The `cdn` is missing."),this.clientId=l(e.clientId).toBeDefined("Snapshot integrity violated. The `clientId` is missing."),this.sessionId=e.sessionId,this.sessionIdExpiry=e.sessionIdExpiry,this.eventSendingStrategy=e.configurations.eventSendingStrategy,this.FT_3DA=e.featureToggles.FT_3DA,this.FT_3DA_UTM_SOURCE_LIST=e.featureToggles.FT_3DA_UTM_SOURCE_LIST,this.FT_3DA_STORAGE_LIFETIME=e.featureToggles.FT_3DA_STORAGE_LIFETIME,this.FT_BF_GOOGLE_ADS=e.featureToggles.FT_BF_GOOGLE_ADS,this.FT_BF_GOOGLE_ADS_LIFETIME=e.featureToggles.FT_BF_GOOGLE_ADS_LIFETIME,this.lockBrowsingStartOnSessionId=e.lockBrowsingStartOnSessionId,this.lockCheckoutStartOnSessionId=e.lockCheckoutStartOnSessionId,this.dataUpdatedAt=e.dataUpdatedAt,this.dataLayer=e.dataLayer,this.isConfigurationLoaded=!0}catch(e){this.logger.writeWarningLog({method:"AnalyticsSDK::loadConfigurationSnapshot()",message:e.message,errorMessage:e.message})}})}saveConfigurationSnapshot(){return a(this,null,function*(){let e={merchantId:this.merchantId,shopperCountryCode:this.shopperCountryCode,cdn:this.cdn,clientId:this.clientId,sessionId:this.sessionId,sessionIdExpiry:this.sessionIdExpiry,configurations:{eventSendingStrategy:this.eventSendingStrategy},featureToggles:{FT_3DA:this.FT_3DA,FT_3DA_UTM_SOURCE_LIST:this.FT_3DA_UTM_SOURCE_LIST,FT_3DA_STORAGE_LIFETIME:this.FT_3DA_STORAGE_LIFETIME,FT_BF_GOOGLE_ADS:this.FT_BF_GOOGLE_ADS,FT_BF_GOOGLE_ADS_LIFETIME:this.FT_BF_GOOGLE_ADS_LIFETIME},lockBrowsingStartOnSessionId:this.lockBrowsingStartOnSessionId,lockCheckoutStartOnSessionId:this.lockCheckoutStartOnSessionId,dataUpdatedAt:Date.now(),dataLayer:this.dataLayer};yield this.dataStorageManager.saveData(this.ANALYTICS_STORAGE_KEY,e)})}loadConfigurationFromServer(){return a(this,null,function*(){try{let e=new URL(`merchant/analytics/sdk/init/${this.merchantId}/${this.shopperCountryCode}`,this.cdn);e.searchParams.append("merchantId",this.merchantId);let t=yield this.http.get(e.toString());this.FT_3DA=t.FT_UtmReplaceSessionStorageWithCookies,this.FT_3DA_UTM_SOURCE_LIST=t.UtmAcceptableUtmSourceList,this.FT_3DA_STORAGE_LIFETIME=t.UtmParamsCookieLifetimeInMinutes,this.FT_BF_GOOGLE_ADS=t.BfGoogleAdsEnabled,this.FT_BF_GOOGLE_ADS_LIFETIME=t.BfGoogleAdsLifetimeInDays}catch(e){this.logger.writeErrorLog({method:"AnalyticsSDK::loadMerchantConfiguration()",message:e.message,errorMessage:e.message})}})}setClientId(e){e?this.clientId=e:this.clientId||(this.clientId=B())}setSessionId(e){let t=Date.now();if(e&&(!this.sessionId||this.sessionId!==e)){this.sessionId=e,this.sessionIdExpiry=t+this.ExpirationTime*60*1e3;return}}setShopperCountryCode(e){this.shopperCountryCode=e}defineBrowserAccessor(e){if(e.browser===void 0||e.browser===null)throw new Error("The configuration.browser property should be defined.");if(t(e.browser))this.browser=new k(e.browser);else if(r(e.browser))this.browser=new O(e.browser.sessionStorage,e.browser.localStorage,e.browser.cookieStorage);else throw new Error("The provided configuration.browser is not supported (could be missing required properties of any of supported types).");function t(o){return typeof o=="object"&&o!==null&&"document"in o}function r(o){return typeof o=="object"&&o!==null&&"localStorage"in o&&"sessionStorage"in o&&"cookieStorage"in o}}defineEventSender(e){switch(this.eventSendingStrategy=e.eventSendingStrategy||0,this.eventSendingStrategy){case 0:this.eventSender=new x(this.DATA_TRACKING_SERVICE_API_URL,this.browser);break;case 1:this.eventSender=new q(this.DATA_TRACKING_SERVICE_API_URL,this.http);break;case 2:this.eventSender=new G(this.DATA_TRACKING_SERVICE_API_URL,this.http);break;case 3:this.eventSender=e.eventSender;break;default:throw new w(`enum value ${this.eventSendingStrategy}`)}}defineLogger(e){var t;switch(this.loggingStrategy=(t=e.loggingStrategy)!=null?t:0,this.loggingStrategy){case 0:this.logger=new D;break;case 1:this.logger=new H;break;case 2:this.logger=new M(new URL("logger",this.DATA_TRACKING_SERVICE_API_URL).toString(),{http:this.http});break;default:throw new w("Custom logger currently not supported.")}}defineUtmParametersHandler(){this.utms=new R(this.browser,this.logger,{FT_3DA:this.FT_3DA,FT_3DA_UTM_SOURCE_LIST:this.FT_3DA_UTM_SOURCE_LIST,FT_3DA_STORAGE_LIFETIME:this.FT_3DA_STORAGE_LIFETIME})}defineGoogleAdsHandler(){this.googleAds=new W(this.browser,this.logger,{bfGoogleAdsEnabled:this.FT_BF_GOOGLE_ADS,bfGoogleAdsLifetimeInDays:this.FT_BF_GOOGLE_ADS_LIFETIME})}defineBorderfreeParametersHandler(){this.borderfreeHandler=new Y(this.browser,this.logger,{FT_3DA:this.FT_3DA,FT_3DA_UTM_SOURCE_LIST:this.FT_3DA_UTM_SOURCE_LIST,FT_3DA_STORAGE_LIFETIME:this.FT_3DA_STORAGE_LIFETIME})}defineDataStorageManager(){this.dataStorageManager=new V(this.browser,this.logger)}updateSession(e){return a(this,null,function*(){(this.sessionId===void 0||this.sessionIdExpiry<e)&&(this.sessionId=B()),this.sessionIdExpiry=e+this.ExpirationTime*60*1e3,yield this.saveConfigurationSnapshot()})}queueEventSending(e,t){this.eventQueue.push({functionName:e,arguments:t})}queueEventDequeue(){for(;this.eventQueue.length>0;){let e=this.eventQueue.pop();if(e&&e.arguments){let t=Array.prototype.slice.call(e.arguments);this[e.functionName](...t)}else this.logger.writeInfoLog("Arguments are undefined or missing for this event")}}init(e,t,r){return a(this,null,function*(){var o;this.merchantId=l(e).toBeDefined("The merchantId is required to load configuration."),this.shopperCountryCode=l(t).toBeDefined("The shopper country is required to load configuration."),this.cdn=l(r==null?void 0:r.cdn).toBeDefined("The CDN currently is required to load configuration. (should be changed in 2025 Q1)"),this.defineBrowserAccessor(r),this.defineLogger(r),this.defineEventSender(r),this.defineDataStorageManager(),yield this.loadConfigurationSnapshot(),(!this.isConfigurationLoaded||this.shopperCountryCode!==t)&&(this.setShopperCountryCode(t),yield this.loadConfigurationFromServer()),this.defineUtmParametersHandler(),this.defineGoogleAdsHandler(),this.defineBorderfreeParametersHandler(),this.setClientId(r.clientId),this.setSessionId(r.sessionId),this.userAgent=this.browser.getUserAgent(),this.screenResolution=this.browser.getScreenResolution(),yield this.utms.handle(r.utms),yield this.googleAds.handle(r.googleAds),yield this.borderfreeHandler.handle((o=r.borderfree)!=null?o:r.utms,this.utms.utmSource),yield this.saveConfigurationSnapshot(),this.isInitialized=!0,this.queueEventDequeue()})}setMerchantCountryCode(e){return a(this,null,function*(){this.shopperCountryCode=l(e).toBeDefined("The shopperCountryCode is required to setup Analytics SDK."),yield this.saveConfigurationSnapshot()})}setDataLayer(e){return a(this,null,function*(){this.dataLayer=e,yield this.saveConfigurationSnapshot()})}sendBrowsingStartEvent(){return a(this,arguments,function*(){try{if(!this.isInitialized){this.queueEventSending(this.sendBrowsingStartEvent.name,arguments);return}let e=Date.now();if(yield this.updateSession(e),this.sessionId===this.lockBrowsingStartOnSessionId)return!1;this.lockBrowsingStartOnSessionId=this.sessionId,yield this.saveConfigurationSnapshot();let t=new U(e,this.clientId,this.sessionId,this.merchantId,this.shopperCountryCode,"Browsing Funnel",this.cdn,this.browser.getPageUrl(),this.browser.getPageTitle(),this.screenResolution,this.userAgent,this.browser.getReferrer(),this.utms.utmSource,this.utms.utmMedium,this.utms.utmCampaign,this.utms.utmTerm,this.utms.utmContent,this.utms.utmAdSet,this.borderfreeHandler.directToCheckoutEnabled||this.borderfreeHandler.directToCheckout?{directToCheckout:this.borderfreeHandler.directToCheckout,directToCheckoutEnabled:this.borderfreeHandler.directToCheckoutEnabled}:null);return yield this.eventSender.send(t),!0}catch(e){this.logger.writeErrorLog({method:"AnalyticsSDK::sendBrowsingStartEvent()",message:e.message,errorMessage:e.message})}})}sendPageViewEvent(){return a(this,arguments,function*(){try{if(!this.isInitialized){this.queueEventSending(this.sendPageViewEvent.name,arguments);return}let e=Date.now();yield this.updateSession(e);let t=new F(e,this.clientId,this.sessionId,this.merchantId,this.shopperCountryCode,"Browsing Funnel",this.cdn,this.browser.getPageUrl(),this.browser.getPageTitle(),this.screenResolution,this.userAgent,this.browser.getReferrer(),this.utms.utmSource,this.utms.utmMedium,this.utms.utmCampaign,this.utms.utmTerm,this.utms.utmContent,this.utms.utmAdSet,this.borderfreeHandler.directToCheckoutEnabled||this.borderfreeHandler.directToCheckout?{directToCheckout:this.borderfreeHandler.directToCheckout,directToCheckoutEnabled:this.borderfreeHandler.directToCheckoutEnabled}:null);yield this.eventSender.send(t)}catch(e){this.logger.writeErrorLog({method:"AnalyticsSDK::sendPageViewEvent()",message:e.message,errorMessage:e.message})}})}sendBrowsingFunnelEvent(r,o){return a(this,arguments,function*(e,t){try{if(!this.isInitialized){this.queueEventSending(this.sendBrowsingFunnelEvent.name,arguments);return}let s=Date.now();yield this.updateSession(s);let n=new K(e,s,this.clientId,this.sessionId,this.merchantId,this.shopperCountryCode,"Browsing Funnel",this.cdn,this.browser.getPageUrl(),this.browser.getPageTitle(),this.screenResolution,this.userAgent,this.browser.getReferrer(),this.utms.utmSource,this.utms.utmMedium,this.utms.utmCampaign,this.utms.utmTerm,this.utms.utmContent,this.utms.utmAdSet,t,this.borderfreeHandler.directToCheckoutEnabled||this.borderfreeHandler.directToCheckout?{directToCheckout:this.borderfreeHandler.directToCheckout,directToCheckoutEnabled:this.borderfreeHandler.directToCheckoutEnabled}:null);yield this.eventSender.send(n)}catch(s){this.logger.writeErrorLog({method:"AnalyticsSDK::sendBrowsingFunnelEvent()",message:s.message,errorMessage:s.message})}})}sendCheckoutStartEvent(t){return a(this,arguments,function*(e){try{if(!this.isInitialized){this.queueEventSending(this.sendCheckoutStartEvent.name,arguments);return}let r=Date.now();if(yield this.updateSession(r),this.sessionId===this.lockCheckoutStartOnSessionId)return!1;this.lockCheckoutStartOnSessionId=this.sessionId,yield this.saveConfigurationSnapshot();let o=new j(r,this.clientId,this.sessionId,this.merchantId,this.shopperCountryCode,"Checkout Funnel",this.cdn,e,this.userAgent,this.utms.utmSource,this.utms.utmMedium,this.utms.utmCampaign,this.utms.utmTerm,this.utms.utmContent,this.utms.utmAdSet,this.borderfreeHandler.directToCheckoutEnabled||this.borderfreeHandler.directToCheckout?{directToCheckout:this.borderfreeHandler.directToCheckout,directToCheckoutEnabled:this.borderfreeHandler.directToCheckoutEnabled}:null);yield this.eventSender.send(o)}catch(r){this.logger.writeErrorLog({method:"AnalyticsSDK::sendCheckoutStartEvent()",message:r.message,errorMessage:r.message})}})}sendCheckoutFunnelEvent(o,s,n){return a(this,arguments,function*(e,t,r){try{if(!this.isInitialized){this.queueEventSending(this.sendCheckoutFunnelEvent.name,arguments),this.logger.writeDebugLog("Exit sendCheckoutFunnelEvent without sending CheckoutFunnelEvent");return}let c=Date.now();yield this.updateSession(c);let d=new N(t,c,this.clientId,this.sessionId,this.merchantId,this.shopperCountryCode,"Checkout Funnel",this.cdn,e,this.userAgent,this.utms.utmSource,this.utms.utmMedium,this.utms.utmCampaign,this.utms.utmTerm,this.utms.utmContent,this.utms.utmAdSet,p(p({},this.dataLayer),r),this.borderfreeHandler.directToCheckoutEnabled||this.borderfreeHandler.directToCheckout?{directToCheckout:this.borderfreeHandler.directToCheckout,directToCheckoutEnabled:this.borderfreeHandler.directToCheckoutEnabled}:null);this.logger.writeDebugLog("Sending CheckoutFunnelEvent"),yield this.eventSender.send(d)}catch(c){this.logger.writeErrorLog({method:"AnalyticsSDK::sendCheckoutFunnelEvent()",message:c.message,errorMessage:c.message})}})}};var ke=J;return Pe(Oe);})();
//# sourceMappingURL=bundle.js.map
